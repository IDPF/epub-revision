<section xmlns="http://docbook.org/ns/docbook" xml:id="sec-metadata-elem"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.1b2"
    xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>The <literal>metadata</literal> Element</title>

    <para><remark role="todo">TODO This section remains to be completed as per <link
                xlink:href="http://code.google.com/p/epub-revision/wiki/ImplementationProposalsMetadata"
                >ImplementationProposalsMetadata</link></remark></para>

    <variablelist xreflabel="metadata" role="elem-synopsis" xml:id="elemdef-opf-metadata">
        <varlistentry>
            <term>Element Name</term>
            <listitem>
                <para><literal>metadata</literal></para>
            </listitem>
        </varlistentry>
        <varlistentry>
            <term>Occurrence</term>
            <listitem>
                <para>Required first child of <xref linkend="elemdef-opf-package"/>.</para>
            </listitem>
        </varlistentry>
        <varlistentry>
            <term>Attributes</term>
            <listitem>
                <para>TODO</para>
            </listitem>
        </varlistentry>
        <varlistentry>
            <term>Content Model</term>
            <listitem>
                <para>In any order: <literal><xref linkend="elemdef-opf-dcidentifier"/></literal>
                    <option>[required]</option>, <literal><xref linkend="elemdef-opf-dctitle"
                        /></literal>
                    <option>[required]</option>, <literal><xref linkend="elemdef-opf-dclanguage"
                        /></literal>
                    <option>[required]</option>, <literal><xref linkend="elemdef-opf-meta"
                        /></literal>
                    <option>[optional]</option>, <literal><xref linkend="elemdef-opf-link"
                        /></literal>
                    <option>[optional]</option></para>
            </listitem>
        </varlistentry>
    </variablelist>

    <para><remark role="todo">@dh: general intro and overview</remark></para>

    <section xml:id="sec-opf-metadata-dcmes">
        <title>Legacy Dublin Core Metadata</title>
        <para><remark role="todo">@dh: general intro, ref back to previous version, the note re may
                be removed in future version</remark></para>

        <section xml:id="elemdef-opf-dcidentifier" xreflabel="dc:identifier">
            <title>The DCMES <literal>identifier</literal> Element</title>
            <para><remark role="todo">@dh: elem-synopsis</remark></para>
        </section>

        <section xml:id="elemdef-opf-dctitle" xreflabel="dc:title">
            <title>The DCMES <literal>title</literal> Element</title>
            <para><remark role="todo">@dh: elem-synopsis</remark></para>
        </section>

        <section xml:id="elemdef-opf-dclanguage" xreflabel="dc:language">
            <title>The DCMES <literal>langauge</literal> Element</title>
            <para><remark role="todo">@dh: elem-synopsis</remark></para>
        </section>

    </section>

    <section xml:id="elemdef-opf-meta" xreflabel="meta">
        <title>The <literal>meta</literal> element</title>
        <para><remark role="todo">@dh: elem-synopsis</remark></para>

        <section xml:id="elemdef-opf-meta-property-values">
            <title>Recognized values for the <literal>meta</literal> element
                    <literal>property</literal> attribute</title>
            <para><remark role="todo">@dh: table with properties, separated in ancillary and package
                    properties (may even split to two tables)</remark></para>
        </section>
    </section>

    <section xml:id="sec-opf-link" xreflabel="link">
        <title>The <literal>link</literal> element</title>

        <para>The <literal>link</literal> element is used to associate external metadata resources
            with the publication.</para>

        <variablelist xreflabel="link" role="elem-synopsis" xml:id="elemdef-opf-link">
            <varlistentry>
                <term>Element Name</term>
                <listitem>
                    <para>
                        <literal>link</literal>
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Occurrence</term>
                <listitem>
                    <para>As a child of <xref linkend="elemdef-opf-metadata"/>. Repeatable.</para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Attributes</term>
                <listitem>
                    <variablelist role="elem-synopsis-attlist">
                        <varlistentry xml:id="attrdef-link-href">
                            <term>
                                <literal>href</literal>
                                <option>[required]</option>
                            </term>
                            <listitem>
                                <para>A valid URL [TODO RFC link] to an external metadata
                                    resource.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry xml:id="attrdef-link-rel">
                            <term>
                                <literal>rel</literal>
                                <option>[required]</option>
                            </term>
                            <listitem>
                                <para>A token that describes the nature of the external resource
                                    (its relation to the publication). See further <xref
                                        linkend="elemdef-opf-link-rel-values"/>.</para>
                            </listitem>
                        </varlistentry>
                        <varlistentry xml:id="attrdef-link-id">
                            <term>
                                <literal>id</literal>
                                <option>[optional]</option>
                            </term>
                            <listitem>                                
                                <xi:include href="../share/id-prose-para.xml"/>                                
                            </listitem>
                        </varlistentry>
                    </variablelist>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Content Model</term>
                <listitem>
                    <para>Empty.</para>
                </listitem>
            </varlistentry>
        </variablelist>

        <para>The resources identified by the <literal>link</literal> element <literal>href</literal> attribute are considered <glossterm
                linkend="gloss-external-resource">external resources</glossterm>, and must therefore not be identified as items in the
            <link linkend="sec-manifest-elem">manifest</link>.</para>
        
        <para>If metadata provided in an external record conflicts with metadata given inline in
            the Package Document metadata element, then the inline metadata takes precedence. <remark role="todo">TODO correct?</remark></para>
        
        <para>Reading Systems are not required to dereference the resources identified through the <literal>link</literal> element.</para>
        
        <!-- There is no provision for specifying the version of the record (this assumes that version information is available inline in the referenced resources) -->

        <section xml:id="elemdef-opf-link-rel-values">
            <title>Recognized values for the <literal>link</literal> element <literal>rel</literal>
            attribute</title>
            
            <informaltable>
                <thead>
                    <tr>
                        <th>value</th>
                        <th>definition</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><literal>onix-record</literal></td>
                        <td>The referenced resource is a record of the ONIX type <xref linkend="refONIX"/></td>
                    </tr>
                    <tr>
                        <td><literal>mods-record</literal></td>
                        <td>The referenced resource is a record of the MODS type <xref linkend="refMODS"/></td>
                    </tr>
                    <tr>
                        <td><literal>xmp-record</literal></td>
                        <td>The referenced resource is a record of the XMP type <xref linkend="refXMP"/></td>
                    </tr>
                    <tr>
                        <td><literal>marc21xml-record</literal></td>
                        <td>The referenced resource is a record of the MARC21 XML type <xref linkend="refMARC21XML"/></td>
                    </tr>
                </tbody>                
            </informaltable>
                                    
            <para>The <literal>link</literal> element <literal>rel</literal> attribute may include additional tokens than the ones
                enumerated above. Such additional tokens must comply to the restrictions defined in
                    <xref linkend="sec-metadata-extensibility"/>.</para>
        </section>

        <section xml:id="sec-opf-link-examples">
            <title>The <literal>link</literal> Element: Examples</title>

            <informalexample>
                <para>The following example shows the <literal>link</literal> element used to
                    associate an ONIX record with the publication.</para>
                <synopsis>
<xi:include parse="text" href="../examples/publications/link-1.xml"/></synopsis>
            </informalexample>

            <informalexample>
                <para>The following example shows the <literal>link</literal> element used to
                    associate two exernal resources with the publication: an XMP record, and a link
                    to an informational web page. Note that as the <literal>foaf:homepage</literal>
                    token is <link linkend="elemdef-opf-link-rel-values">not defined by this
                        specification</link>, the <link linkend="sec-metadata-extensibility"
                        >metadata extensibility mechanism</link> is employed.</para>
                <synopsis>
<xi:include parse="text" href="../examples/publications/link-2.xml"/></synopsis>
            </informalexample>

        </section>
    </section>

    <section xml:id="sec-metadata-identifiers">
        <title>Publication Identifiers</title>
        <para><remark role="todo">TODO pending finalization of WG discussion</remark></para>
        <!-- TODO reenable
            <para>The Package Document's author is responsible for choosing a
            primary identifier that is unique to one and only one particular package (i.e.,
            the set of resources referenced from the package document's manifest).</para> 
            <para role="rsconferr">Reading Systems must not fail catastrophically if they
            encounter two distinct EPUB Publications with the same purportedly unique
            primary identifier. </para>
        -->
    </section>

    <section xml:id="sec-metadata-extensibility">
        <title>Metadata extensibility</title>
        <para><remark role="todo">@dh: explain meta+link extensibility mechanism
            (@prefix)</remark></para>

    </section>

    <section>
        <title>Scripted Content Documents</title>
        <para role="epubconf">In EPUB Publications, Content Documents must not contain any
                <literal>script</literal> elements unless the manifest item corresponding to that
            Content Document contains the <literal>property</literal> value
                <literal>scripted</literal> (thus indicating a <emphasis role="bold">Scripted
                Content Document).</emphasis>Since scripted content may be processed differently,
            with features such as pagination potentially disabled, content items that set the
            property value of "scripted" should not be spine items unless absolutely required by a
            publication (i.e. scripted content hould if possible be nested, contained within
            top-level content via "object" or "iframe").</para>

        <para role="rsconf">Reading Systems may render Scripted Content Documents as an interactive,
            scripted HTML User Agent according to <xref linkend="refHTML5"/> rather than according
            to the simplified processing model defined for EPUB User Agents in <xref
                linkend="refContentDocs3"/>, i.e. with scripting enabled. Reading Systems should not
            enable scripting for any resources other than Scripted Content Documents.</para>

        <para role="rsconf">Reading Systems may implement support for Scripted Content Documents in
            a manner that disables other EPUB capabilities and/or provides a different rendering
            such as, for example, disabling pagination.</para>
    </section>

    <section xml:id="sec-metadata-examples">
        <title>Full Package Metadata Examples</title>
        <para><remark role="todo">TODO</remark></para>
    </section>

</section>
