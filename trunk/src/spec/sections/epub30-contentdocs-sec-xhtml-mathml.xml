<section xml:id="sec-xhtml-mathml" xmlns="http://docbook.org/ns/docbook"
    xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:epub="http://www.idpf.org/2011/epub"
    xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1">
    <title>Embedded MathML</title>

    <section xml:id="sec-xhtml-mathml-intro">
        <title>Introduction</title>

        <para>XHTML Content Documents support embedded MathML, but limits its usage to a restricted
            subset of the full MathML markup language.</para>

        <para>This subset is designed to ease the implementation burden on Reading Systems and to
            promote accessibility, while retaining compatibility with HTML5 User Agents <xref
                linkend="refMathML"/>
            <xref linkend="refHTML5"/>. </para>

        <note>
            <para>The <property><olink type="epub-spec" targetdoc="publications"
                        targetptr="propdef-mathml"/></property> property of the <xref
                    linkend="gloss-manifest"/>
                <code>item</code> element indicates that an XHTML Content Document contains embedded
                MathML.</para>
        </note>

        <!-- perhaps do this for svg too (and epub namespace) -->
        <para>In the following subsections, the prefix <literal>m</literal> is used for the MathML
            namespace (<literal>http://www.w3.org/1998/Math/MathML</literal>).</para>

    </section>

    <section xml:id="sec-xhtml-mathml-conf-content">
        <title>Embedded MathML Content Conformance</title>

        <para>Any occurence of MathML markup in XHTML Content Documents must conform to the
            constraints expressed in the MathML specification <xref linkend="refMathML"/>, with the
            following additional restrictions:</para>

        <variablelist role="conformance-list">
            <varlistentry xml:id="math-pres">
                <term>Presentation MathML</term>
                <listitem>
                    <para xml:id="confreq-mathml-pres">The <code>m:math</code> element must only
                        contain <link xlink:href="http://www.w3.org/TR/MathML/chapter3.html"
                            >Presentation MathML</link>, with the exception of the
                            <code>m:annotation-xml</code> element, as defined below.</para>
                </listitem>
            </varlistentry>
            <varlistentry xml:id="math-cont">
                <term>Content MathML</term>
                <listitem>
                    <para xml:id="confreq-mathml-annot-cont"><link
                            xlink:href="http://www.w3.org/TR/MathML/chapter4.html">Content
                            MathML</link> may be included within MathML markup in XHTML Content
                        Documents, and must if so occur within an <code>m:annotation-xml</code>
                        element with the <code>encoding</code> attribute valued
                            <literal>"MathML-Content"</literal> or
                            <code>"application/mathml-content+xml"</code> (these values are
                        equivalent), and the <code>name</code> attribute valued
                            <literal>contentequiv</literal>. </para>
                </listitem>
            </varlistentry>
            <varlistentry xml:id="math-xhtml">
                <term>XHTML Content Document fragments</term>
                <listitem>
                    <para xml:id="confreq-mathml-annot-xht">XHTML Content Document fragments may be
                        included within MathML markup in XHTML Content Documents, and must if so
                        occur within an <code>m:annotation-xml</code> element with the
                            <code>encoding</code> attribute valued
                            <literal>application/xhtml+xml</literal>, and the <code>name</code>
                        attribute valued <literal>alternate-representation</literal>. </para>
                    <para xml:id="confreq-mathml-annot-xht-math">When an XHTML Content Document
                        fragment is included as per above, then that fragment must not itself
                        contain MathML markup.</para>
                    <para xml:id="confreq-mathml-annot-xht-model">Any included XHTML Content
                        Document fragments must conform to the content model in which the ancestor
                            <code>m:math</code> element occurs, such that if the <code>m:math</code>
                        element is replaced by the given XHTML Content Document fragment, the
                        document remains valid.</para>
                </listitem>
            </varlistentry>
        </variablelist>

        <!-- prolly not needed as its explained in the coming subsection...
        <note>
            <para>Including XHTML Content Document fragments as per above is the recommended method
                to employ when providing extensive alternative textual content...</para>
        </note>-->

        <section xml:id="sec-xhtml-mathml-alt">
            <title>Alternative Content</title>

            <para>To support assistive technologes, alternative textual content should be included
                with each occurence of the <code>m:math</code> element in XHTML Content
                Documents.</para>

            <para>The <code>alttext</code> attribute on the <code>m:math</code> element should be
                used for this purpose primarily when shorter alternative text runs are sufficient.
                When more extensive alternative text is required, <link linkend="math-xhtml">XHTML
                    Content Document fragments</link> should be used. (Note that Reading Systems
                query these two alternative text locations using a defined <link
                    linkend="confreq-mathml-rs-alt-text">preference order</link>.) </para>

            <para>For Reading System forward compatibility purposes, fallback images may be provided
                using the <code>altimg</code> attribute on the <code>m:math</code> element. It is
                recommended that the dimension and alignment attributes (<code>altimg-width</code>,
                    <code>altimg-height</code> and <code>altimg-valign</code>) be used in
                conjunction with the <code>altimg</code> attribute.</para>

            <note xml:id="note-mathml-altimg-refprops-pkg">
                <!-- note similar statement for xhtml, svg and css and mathml alternative content -->
                <para>Any images referenced from <code>altimg</code> attributes must conform to the
                    constraints for Publication Resources defined in <olink type="epub-spec"
                        targetdoc="publications" targetptr="sec-epub-content-conf"/></para>
            </note>
        </section>
    </section>


    <section xml:id="sec-xhtml-mathml-rs-conf">
        <title>Embedded MathML Reading System Conformance</title>

        <para>A conformant <xref linkend="gloss-epub-reading-system"/> must meet all of the
            following criteria for processing MathML embedded in XHTML Content Documents:</para>

        <itemizedlist role="conformance-list" xml:id="mathml-rs-confreqs">
            <listitem>
                <para xml:id="confreq-mathml-rs-behavior">It must support processing of <link
                        xlink:href="http://www.w3.org/TR/MathML/chapter3.html">Presentation
                        MathML</link> and may support processing of <link
                        xlink:href="http://www.w3.org/TR/MathML/chapter4.html">Content MathML</link>
                    using semantics defined by the MathML 3.0 specification <xref
                        linkend="refMathML"/>.</para>
            </listitem>
            <listitem>
                <para xml:id="confreq-mathml-rs-render">If it has a <xref linkend="gloss-viewport"/>,
                    it must support visual rendering of Presentation MathML.</para>
            </listitem>
            <listitem>
                <para xml:id="confreq-mathml-rs-alt-text"> When attaining <link
                        linkend="sec-xhtml-mathml-alt">alternative textual content</link> for MathML
                    markup, it must give preference to <link linkend="math-xhtml">XHTML Content
                        Document fragments</link>, followed by the <code>alttext</code> attribute on
                    the <code>m:math</code> element.</para>
            </listitem>
            <listitem>
                <para xml:id="confreq-rs-mathml-prop">It must regard the <olink type="epub-spec"
                        targetdoc="publications" targetptr="propdef-mathml"/> property of the <xref
                        linkend="gloss-package-document"/>
                    <xref linkend="gloss-manifest"/>
                    <code>item</code> element as the authoritative definition of whether an XHTML
                    Content Document includes embedded MathML.</para>
            </listitem>

        </itemizedlist>
    </section>

</section>
