<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="../../util/docbook/schema/docbookspec.rng" type="xml"?>
<?oxygen SCHSchema="../../util/docbook/schema/docbookspec.sch"?>
<?oxygen SCHSchema="../../util/docbook/schema/docbook.sch"?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.1b2">
   <title>Open Packaging Format (OPF) 3.0</title>

    <info>
        <releaseinfo>Internal Working Group Draft</releaseinfo>
        <pubdate>2010-xx-xx</pubdate>

        <printhistory>
            <formalpara>
                <title>This version</title>
                <para><link xlink:href="www.idpf.org/specs/TODO"/></para>
            </formalpara>
            <formalpara>
                <title>Previous version</title>
                <para><link xlink:href="www.idpf.org/specs/TODO"/></para>
            </formalpara>
            <formalpara>
                <title>Diffs to previous version</title>
                <para><link xlink:href="www.idpf.org/specs/TODO"/></para>
            </formalpara>
        </printhistory>

        <copyright>
            <year>2010</year>
            <year>2011</year>
            <holder>International Digital Publishing Forumâ„¢</holder>
        </copyright>

        <legalnotice>
            <para>All rights reserved. This work is protected under Title 17 of the United States
                Code. Reproduction and dissemination of this work with changes is prohibited except
                with the written permission of the International Digital Publishing Forum.</para>
        </legalnotice>

        <authorgroup>
            <editor>
                <personname>Garth Conboy</personname>
                <affiliation>
                    <org>
                        <orgname>eBook Technologies</orgname>
                    </org>
                </affiliation>
            </editor>
            <editor>
                <personname>Markus Gylling</personname>
                <affiliation>
                    <org>
                        <orgname>DAISY Consortium</orgname>
                    </org>
                </affiliation>
            </editor>
            <editor>
                <personname>William McCoy</personname>
                <affiliation>
                    <org>
                        <orgname>WebPaper LLC</orgname>
                    </org>
                </affiliation>
            </editor>
            <editor>
                <personname><remark role="todo">TBD - additional editors</remark></personname>
            </editor>

        </authorgroup>

        <abstract>
            <title>Abstract</title>
            <para><remark role="todo">TODO</remark></para>
        </abstract>

    </info>

    <chapter xml:id="sec-overview">
        <title>Overview</title>
        <para>This specification, the Open Packaging Format 3.0 (<emphasis role="bold"
                >OPF3</emphasis>), defines a document format for representing a collection of
            related resources </para>
        <para>OPF3 is part of a family of related specifications that comprise the <link linkend="refEPUB"
                >EPUB3</link> publication format.</para>
        <section xml:id="sec-overview-purpose-and-scope">
            <title>Purpose and Scope</title>

            <para>This specification, the Open Packaging Format 3.0 (OPF3) , defines an XML schema
                for a package file format and associated document type that enables the various
                components of an an abstract publication (set of related resources) can be
                associated. Specifically, OPF3 enables representation of a publication that:</para>
                <itemizedlist>
                    <listitem><para>Enumerates and describes all its resources and their media types. </para></listitem>
                    <listitem><para>Specifies a linear ordering of its top-level resources.TODO: 'top level'</para></listitem>
                    <listitem><para>Specifies "fallback chains" that allow for alternative handling o</para></listitem>
                    
            </itemizedlist>
            <para>OPF3 is a general-purpose technology. While illustrative examples in this
                specification may be based on the use of OPF3 by EPUB, all conformance requirements
                specific to EPUB as an application of OPF are defined in the EPUB
                specification.</para>
        </section>
        <section xml:id="sec-overview-relationship">
            <title>Relationship to Other Specifications</title>
            <para>This specification relies on several other building-block specifications. OPF is
                an application of XML, and by default all terminology used in this specification has
                the same meaning as its use in XML. OPF also relies on XML Namespaces, and i this
                specification the term "XML namespace" (or just "namespace") has the meaning defined
                in that specification. Additionally, OPF utilizes X, Y, and Z. </para>
            <para>OPF3 is a revision to, and supersedes, Open Package Format 2.0.1 (OPF2), with
                respect to the definition of the Package Document schema. Other information from
                OPF2 has been superseded by EPUB Publications 3.0 (Publications3).</para>
            <para>
                <remark role="todo"><remark role="todo"> TBD: enumerate other dependent specs
                    </remark>TBD: statement about layered use of terminology from other dependent
                    specs </remark>
                <remark role="todo"> TBD: statement about conformance requirements based on
                    dependent specs</remark>
            </para>
            </section>

        <section xml:id="sec-overview-terminology">
            <title>Terminology</title>
            <glosslist>
                <glossentry xml:id="gloss-epub-publication">
                    <glossterm>OPF Package Document (<emphasis role="underline">or</emphasis>
                        Package Document)</glossterm>
                    <glossdef>
                        <para>An XML Document conformant with the Package schema and additional
                            constraints defined in this specification</para>
                    </glossdef>
                </glossentry>
            </glosslist>
        </section>            
        
        <section xml:id="sec-overview-conformance">
            <title>Conformance</title>
            <xi:include href="./share/conformancestatements.xml"/>
        </section>

    </chapter>

    <chapter xml:id="sec-package-docs">
        <title>OPF Package Documents</title>
        <para>Open Package Format 3.0 (OPF3) is purposely designed as a general technology that can
            be used by other file formats, not just EPUB. The fundamental construct defined in this
            specification is a Package Document, which is set of enumerated resources (the
            manifest), which contains an ordered sequence of top-level resources from which all
            other resources in the set can be reached or utilized in the context of a given
            application of OPF3 (the spine).</para>
        <para><remark role="todo">TODO DIAGRAM: show visual graph of abstract "hedge" here, inc
                fallback chains, a fallback-style, and sharing resources between roots.</remark>In
            addition Package Documents include a means of including and/or referencing metadata
            applicable to the entire collection including a means for referencing a "TOC" item, an
            optional means for an item to reference an ordered list of alternative items (a fallback
            chain) and/or a style resource, and an additional optional sequence of some or all
            top-level resources (the Guide).</para>
        <para><remark role="todo">TODO LIST: replace or supplement above prose with list of major
                parts of Package Documents, concise form of list in sec 2.0 OPF 2.0.1.</remark>The
            semantics of processing Package Documents is considered application specific and is not
            provided in this specification. At the level of this specification, items of any kind
            (including style objects, metadata objects, and TOC) are simply abstract URI references
            to resources that specify a MIME type, whose significance is not defined in this
            specification. Inter-item references are always via id attributes. A valid Package
            Document must meet the abstract conformance requirements of this specification, but
            would typically need to meet additional requirements to be conformant in the context of
            a particular application, such as requiring that certain references be to items of a
            specific MIME type supported by that application. NOTE: the semantics of processing
            Package Documents in the context of [EPUB] are defined in [EPUB Publications]. </para>
        <para/>
        <section xml:id="sec-package-element">
            <title>Package Document and root Package Element</title>
            <para role="contentconf">An OPF Package Document must be a well-formed XML
                Document.</para>
            <para role="contentconf">A Package Document MUST be encoded in UTF-8 or UTF-16 as
                defined by <xref linkend="refUnicode5"/> and be valid according to the OPF3 Package
                Document schema (<remark role="todo">TODO: Appendix A</remark>). Note that this
                schema is normative and in case of conflicts between the specification prose and
                this document, the schema shall be considered definitive.  </para>
            <para role="contentconf">A Package Document must exist as a root XML file that should be
                named ending in the extension ".opf", and is considered to have the MIME media type
                "application/oebps-package+xml". This root XML file may refer to other XML files via
                XMLâ€™s general entity mechanism, but those files must not use the .opf file
                extension. </para>
            <para role="contentconf">The package element must be the one and only one root element
                in an OPF Package Document; all other elements in the Package Document must be
                nested within it. The package element's namespace must be
                "http://www.idpf.org/2007/opf". <remark role="todo">do we need new namespace for OPF3?</remark></para>
            <para role="contentconf">The package element must have a version attribute with a value
                of "3.0".</para>
            <para role="contentconf">The package element must specify a value for its unique-identifier attribute. The
                unique-identifier attribute's value specifies which Dublin Core identifier element,
                described in Section 2.2.10, provides the package's preferred, or primary,
                identifier. The OPF Package Document's author is responsible for choosing a primary
                identifier that is unique to one and only one particular package (i.e., the set of
                files referenced from the package document's manifest). </para>
            <para>The semantics of processing Package Documents is considered application specific
                and is not provided in this specification. At the level of this specification, items
                of any kind (including style objects, metadata objects, and TOC) are simply abstract
                URI references to resources that specify a MIME type, whose significance is not
                pertinent to this specification. Inter-item references are always via id attributes.
                A valid Package Document must meet the abstract conformance requirements of this
                specification, but would typically need to meet additional  requirements to be
                conformant in the context of a particular application, such as requiring that
                certain references be to items of a specific MIME type supported by that
                application. NOTE: the semantics of processing Package Documents in the context of
                [EPUB] is defined in [EPUB Publications]. </para>
            <para><remark role="todo">TODO EXAMPLE: from sec 2.0 of OPF 2.0.1</remark></para>
            <para> </para>
        </section>
        <section xml:id="sec-manifest-elem">
            <title>Manifest element</title>
            <para role="contentconf">The package element must contain one and only one manifest
                element as its first sub-element. The manifest element must contain at least one
                item element, each describing a content item. The manifest must not include item
                elements referring to the XML file or files that make up the OPF Package Document,
                and no item in the manfest may have the MIME media type
                "application/oebps-package+xml". Each item element contained within a manifest
                element must have the attributes id, href (a URI; if relative, the URI is
                interpreted as relative to the OPF Package File containing the reference), and
                media-type (specifying the itemâ€™s MIME media type). The order of item elements in
                the manifest is not significant. </para>
            <section>
                <title>Fallback Chains</title>
                <para role="contentconf"> An item in the manifest may optionally contain the atttribute "fallback". If
                    present it must be an id reference to another item in the manifest. The ordered
                    list of all id references that can be reached starting from any item's
                    "fallback" attribute is considered to be the "fallback chain" for that item.
                    There MUST NOT be any circulare references in any fallback chains. The semantics
                    of fallback chains are application dependent, but they would typically be used
                    to reference a set of items that can be considered equivalents, that an
                    application could choose between in rendering content.</para>
            </section>
            <section>
                <title>Fallback Styles</title>
                <para role="contentconf">An item in the manifest may optionally contain the atttribute
                    "fallback-style", whose value must be an id reference to another item in the
                    manifest. The semantics of this reference and any additional conformance
                    requirements are application dependent, but it would typically be used in order
                    to associate a CSS style sheet with custom XML content.</para>
                <para>
                    <remark role="todo">TODO EXAMPLE: first one from sec 2.3 of OPF 2.0.1</remark>
                </para>
            </section>
           
        </section>
        <section xml:id="sec-spine-elem">
            <title>Spine element</title>
            <para role="contentconf">Following the manifest, there must be one and only one spine element. The spine
                provides an ordered list of a subset of  items listed in the manifest. The semantics
                of this ordered list are application dependent but it would typically be used to
                represent a reading or presentation order for the content, with content items not
                appearing in the spine being ancillary to those that do appear there.</para>
            <para role="contentconf">A specific spine item (from the perspective of its id attribute value in manifest)
                must not appear more than once in spine. </para>
            <para role="contentconf">Spine items may contain an optional attribute "linear"
                    whose default value is "true". This reference indicates whether a spine item is
                    considered primary (linear=true) or auxiliary (linear=false). The
                semantics of this indication are applicaiton dependent, but might include
                distinguishing presentation of "body" content from ancillary  or "sidebar" content
                which might be, for example, presented in a popup window, or omitted from an aural
                rendition.</para>
            <para role="contentconf">The spine element must include a toc attribute, whose value is an id reference to
                another item in the manifest. The semantics of this reference and any additional
                conformance requirements are application dependent, but it would typically be  used
                to represent an additional mapping into the content besides the spine.</para>
            

        </section>
        <section>
            <title>Metadata</title>
            <para role="contentconf">
                The required metadata element is used to provide information
                    about the publication as a whole. It may contain Dublin Core metadata elements
                    directly or...
                <remark role="todo">TODO: include general (non-EPUB-specific) OPF material here
                    based on metadata subgroup solution proposal.</remark>
            </para>
        </section>
        <section><title>Guide</title><para role="contentconf">The package element may contain one guide element, which if present must
                contain one or more reference elements. Each reference must have an href attribute,
                which may include a fragment identifier as defined in section 4.1 of RFC 2396 (see
                http://www.ietf.org/rfc/rfc2396.txt). Each reference must further have "type" and
                "title" values whose values must be strings. The semantics and processing rules for
                the guide element are application specific.</para>
            <remark role="todo">TODO: Guide example from OPF2</remark></section>
    </chapter>


    <appendix xml:id="acknowledgements" role="acknowledgements" conformance="informative">
        <title>Contributors</title>
        <xi:include href="./share/contributors.xml"/>
        </appendix>
    <bibliography xml:id="references">
        <title>References</title>

        <!-- note when adding "et al." to the end of a personname field, omit the terminating 
            period; one is auto-generated after -->

        <bibliodiv>
            <title>Normative References</title>
            <biblioentry xml:id="refIRI">
                <abbrev>IRI</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc3987.txt"> Internationalized
                        Resource Identifier</link>
                </title>
                <author>
                    <personname>M. Duerst, et al</personname>
                </author>
                <date>January 2005</date>
            </biblioentry>
            <biblioentry xml:id="refODF">
                <abbrev>ODF</abbrev>
                <title><link xlink:href="http://www.oasis-open.org/committees/download.php/12572/OpenDocument-v1.0-os.pdf">ODF Open Document Format</link></title>
            </biblioentry>
            <biblioentry xml:id="refODFManifestSchema">
                <abbrev>ODF10 Manifest Schema</abbrev>
                <title><link xlink:href="http://www.oasis-open.org/committees/download.php/12570/OpenDocument-manifest-schema-v1.0-os.rng">ODF 1.0 Manifest Schema</link></title>
            </biblioentry>

            <biblioentry xml:id="refOPF">
                <abbrev>OPF</abbrev>
                <title><link xlink:href="http://www.idpf.org/doc_library/epub/OPF_3.0_draft.htm">Open Packaging Format</link><remark role="todo">TODO fix
                    link</remark></title>
            </biblioentry>
            <biblioentry xml:id="refOPS">
                <abbrev>OPS</abbrev>
                <title><link xlink:href="http://www.idpf.org/doc_library/epub/OPS_2.0.1_draft.htm">Open Publication Structure</link><remark role="todo">TODO fix
                    link</remark></title>
            </biblioentry>
            <biblioentry xml:id="refRelaxNG">
                <abbrev>RelaxNG</abbrev>
                <title>
                    <link xlink:href="http://standards.iso.org/ittf/PubliclyAvailableStandards/c052348_ISO_IEC_19757-2_2008(E).zip">ISO/IEC 19757-2: Regular-grammar-based validation &#8212; RELAX NG</link>
                </title>
                <date>3 December 2001</date>
            </biblioentry>
            <biblioentry xml:id="refRFC2046">
                <abbrev>RFC2046</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc2046.txt">Multipurpose Internet
                        Mail Extensions (MIME) Part Two: Media Types</link> (RFC 2046) </title>
                <author>
                    <personname>N. Freed, N. Borenstein</personname>
                </author>
                <date>November 1996</date>
            </biblioentry>
            <biblioentry xml:id="refRFC2048">
                <abbrev>RFC2048</abbrev>
                <title><link xlink:href="http://www.ietf.org/rfc/rfc2048.txt">Multipurpose Internet
                        Mail Extensions (MIME) Part Four: Registration Procedures </link> (RFC
                    2048)</title>
                <author>
                    <personname>Freed, et al</personname>
                </author>
                <date>November 1996</date>
            </biblioentry>
            <biblioentry xml:id="refRFC2119">
                <abbrev>RFC2119</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs
                        to Indicate Requirement Levels</link> (RFC 2119) </title>
                <date>March 1997</date>
            </biblioentry>
            <biblioentry xml:id="refRFC3986">
                <abbrev>RFC3986</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc3986.txt">Uniform Resource
                        Identifier (URI): Generic Syntax</link> (RFC 3986) </title>
                <author>
                    <personname>Berners-Lee, et al</personname>
                </author>
                <date>January 2005</date>
            </biblioentry>
            <biblioentry xml:id="refRFC3987">
                <abbrev>RFC3987</abbrev>
                <title>
                    <link xlink:href="http://www.ietf.org/rfc/rfc3987.txt">Internationalized
                        Resource Identifiers (IRIs)</link> (RFC 3987) </title>
                <author>
                    <personname>M Duerst, et al</personname>
                </author>
                <date>January 2005</date>
            </biblioentry>
            <biblioentry xml:id="refUAAG10">
                <abbrev>UAAG10</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/WAI-USERAGENT/">User Agent Accessibility
                        Guidelines 1.0</link>
                </title>
                <author>
                    <personname>Ian Jacobs, et al</personname>
                </author>
                <date>17 December 2002</date>
            </biblioentry>
            <biblioentry xml:id="refUnicode5">
                <abbrev>Unicode</abbrev>
                <title>The Unicode Consortium. The Unicode Standard, Version 5.0.0, defined by: The
                    Unicode Standard, Version 5.0 (Boston, MA, Addison-Wesley, 2007. ISBN
                    0-321-48091-0)</title>
            </biblioentry>
            <biblioentry xml:id="refWCAG20">
                <abbrev>WCAG20</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/WCAG20/">Web Content Accessibility
                        Guidelines (WCAG) 2.0</link>
                </title>
                <author>
                    <personname>Ben Caldwel, et al</personname>
                </author>
                <date>11 December 2008</date>
            </biblioentry>
            <biblioentry xml:id="refXML">
                <abbrev>XML</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/2008/REC-xml-20081126/">Extensible Markup
                        Language (XML) 1.0 (Fifth Edition)</link>
                </title>
                <author>
                    <personname>T. Bray, et al</personname>
                </author>
                <date>26 November 2008</date>
            </biblioentry>
            <biblioentry xml:id="refXMLENCCORE">
                <abbrev>XML ENC Core</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/2002/REC-xmlenc-core-20021210">XML
                        Encryption Syntax and Processing</link>
                </title>
                <author>
                    <personname>D. Eastlake, et al</personname>
                </author>
                <date>10 December 2002</date>
            </biblioentry>
            <biblioentry xml:id="refXMLDSIGCORE">
                <abbrev>XML DSIG Core</abbrev>
                <title>
                    <link xlink:href="http://www.w3.org/TR/2002/REC-xmldsig-core-20020212">XML-Signature Syntax and Processing</link>
                </title>
                <author>
                    <personname>M. Bartel, et al</personname>
                </author>
                <date>12 February 2002</date>
            </biblioentry>
            <biblioentry xml:id="refEPUB">
                <abbrev>EPUB3 Overview</abbrev>
                <title><link
                    xlink:href="http://www.oasis-open.org/committees/download.php/12572/XXX"
                    >EPUB3 Overview</link></title>
            </biblioentry>
        </bibliodiv>

    </bibliography>  
</book>
