<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="../../util/docbook/schema/docbookspec.rng" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>
<?xml-model href="../../util/docbook/schema/docbookspec.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<?xml-model href="../../util/docbook/schema/docbook.sch" type="application/xml" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns:epub="http://www.idpf.org/2011/epub" xmlns:xi="http://www.w3.org/2001/XInclude"
    version="5.1">
    <title>EPUB Media Overlays 3.0</title>

    <info>
        <releaseinfo>Recommended Specification</releaseinfo>
        <pubdate>11 October 2011</pubdate>
        <printhistory>
            <formalpara>
                <title>This version</title>
                <para>
                    <link
                        xlink:href="http://www.idpf.org/epub/30/spec/epub30-mediaoverlays-20111011.html"
                    />
                </para>
            </formalpara>
            <formalpara>
                <title>Latest version</title>
                <para>
                    <link xlink:href="http://www.idpf.org/epub/30/spec/epub30-mediaoverlays.html"/>
                </para>
            </formalpara>
            <formalpara>
                <title>Previous version</title>
                <para>
                    <link
                        xlink:href="http://www.idpf.org/epub/30/spec/epub30-mediaoverlays-20110908.html"
                    />
                </para>
            </formalpara>
        </printhistory>
        <releaseinfo role="errata"> Please refer to the <link
                xlink:href="./epub30-mediaoverlays-errata/">errata</link> for this document, which
        	may include some normative corrections. </releaseinfo>
        <releaseinfo role="diff"> A diff of changes from the previous draft is available at <link
            xlink:href="http://code.google.com/p/epub-revision/source/diff?spec=svn3218&amp;old=3183&amp;r=3218&amp;format=side&amp;path=%2Ftrunk%2Fsrc%2Fspec%2Fepub30-mediaoverlays.xml"
                >this link</link>. </releaseinfo>
        <xi:include href="./share/copyright.xml"/>
        <xi:include href="./share/legalnotice.xml"/>
        <authorgroup>
            <editor>
                <personname>Marisa DeMeglio</personname>
                <affiliation>
                    <org>
                        <orgname>DAISY Consortium</orgname>
                    </org>
                </affiliation>
            </editor>
            <editor>
                <personname>Daniel Weck</personname>
                <affiliation>
                    <org>
                        <orgname>DAISY Consortium</orgname>
                    </org>
                </affiliation>
            </editor>
        </authorgroup>
        <abstract>
            <title>EPUB Media Overlays 3.0</title>
            <para>EPUB Media Overlays 3.0 specifies a usage of <xref linkend="refSMIL"/>, the <xref
                    linkend="gloss-package-document"/>, the <xref linkend="gloss-stylesheet"/>, and
                the <xref linkend="gloss-content-document-epub"/> for representation of audio
                synchronized with the EPUB Content Document. This specification is one of a family
                of related specifications that comprise EPUB 3.</para>
        </abstract>
    </info>

    <chapter xml:id="sec-overview">
        <title>Overview</title>
        <section xml:id="sec-overview-purpose-and-scope" conformance="informative">
            <title>Purpose and Scope</title>
            <para>This specification, EPUB Media Overlays 3.0, defines a usage of <xref
                    linkend="refSMIL"/> (Synchronized Multimedia Integration Language), the <xref
                    linkend="gloss-package-document"/>, the <link linkend="gloss-stylesheet">EPUBÂ®
                    Style Sheet</link>, and the <xref linkend="gloss-content-document-epub"/> for
                representation of audio synchronized with the EPUB Content Document.</para>


            <xi:include href="./share/specdesc-prepara.xml"/>
            <itemizedlist xml:id="epub-specs-listing">
                <xi:include href="./share/specdesc-overview.xml"/>
                <xi:include href="./share/specdesc-publications.xml"/>
                <xi:include href="./share/specdesc-contentdocs.xml"/>
                <xi:include href="./share/specdesc-ocf.xml"/>
            </itemizedlist>
        </section>

        <section xml:id="sec-overview-relationship" conformance="informative">
            <title>Relationship to Other Specifications</title>
            <para>This specification relies on a subset of <xref linkend="refSMIL"/>, from which the
                EPUB Media Overlays elements and attributes defined in <xref
                    linkend="sec-overlays-def"/> are derived.</para>
        </section>

        <section xml:id="sec-terminology">
            <title>Terminology</title>
            <xi:include href="./share/terminology.xml"/>
        </section>

        <xi:include href="./share/conformancestatements.xml"/>

    </chapter>

    <chapter xml:id="sec-media-overlays-document-definition">
        <title>Media Overlay Document Definition</title>

        <section xml:id="sec-overlays-introduction" conformance="informative">
            <title>Introduction</title>
            <para>Books featuring synchronized audio narration are found in mainstream e-books,
                educational tools and e-books formatted for persons with print disabilities. In EPUB
                3, these types of books are created by using Media Overlay Documents to describe the
                timing for the pre-recorded audio narration and how it relates to the EPUB Content
                Document markup. The file format for Media Overlays is defined as a subset of <link
                    linkend="refSMIL">SMIL</link>, a W3C recommendation for representing
                synchronized multimedia information in XML.</para>
            <para>The Media Overlays feature is designed to be transparent to <xref
                    linkend="gloss-epub-reading-system"/>s that do not support the feature. The
                inclusion of Media Overlays in an EPUB Publication has no impact on the ability of
                Media Overlay-unaware Reading Systems to render that Publication as a "regular" EPUB
                Publication. </para>

            <para>Although future versions of this specification may incorporate support for video
                media (e.g., synchronized text/sign-language books), this version supports only
                synchronizing audio media with the EPUB Content Document. </para>
        </section>

        <section xml:id="sec-overlays-content-conf">
            <title>Content Conformance</title>
            <para>A <xref linkend="gloss-media-overlay-document"/> <literal role="rfc2119">must</literal> meet all of the following
                criteria:</para>
            <variablelist role="conformance-list">
                <varlistentry xml:id="confreq-mo-docprops">
                    <term>Document Properties</term>
                    <listitem role="conformance-item">
                        <para xml:id="confreq-mo-xml">
                            <xi:include href="./share/xml-defref.xml"/>
                        </para>
                        <!--
                        <para xml:id="confreq-mo-docprops-xml">
                            <xi:include href="./share/xml-wellformed.xml"/>
                        </para>
                        <para xml:id="confreq-mo-docprops-extmarkupdecl">
                            <xi:include href="./share/xml-extmarkupdecl.xml"/>
                        </para>
                        <para xml:id="confreq-mo-docprops-xinc">
                            <xi:include href="./share/xml-xinc.xml"/>
                        </para>
                        <para xml:id="confreq-mo-docprops-enc">
                            <xi:include href="./share/xml-enc.xml"/>
                        </para>      
                        -->
                        <para xml:id="confreq-mo-docprops-schema">It <literal role="rfc2119">must</literal> be valid to the Media
                            Overlays schema as defined in <xref linkend="app-overlays-schema"/> and
                            conform to all content conformance constraints expressed in <xref
                                linkend="sec-overlays-def"/>.</para>
                        <para xml:id="confreq-mo-docprops-structure">It <literal role="rfc2119">must</literal> be authored to reflect
                            the structure of the <xref linkend="gloss-content-document-epub"/> with
                            which it is associated, as stated in <xref
                                linkend="sec-media-overlays-structure"/>. </para>
                        <para xml:id="confreq-mo-docprops-embed"><xref linkend="gloss-author"/>s
                            <literal role="rfc2119">should</literal> avoid using scripts to control audio and video embedded in the
                            EPUB Content Document, as stated in <xref linkend="sec-audio-video"/>. </para>
                        <para xml:id="confreq-mo-docprops-semantics">It <literal role="rfc2119">should</literal> use semantic markup
                            where appropriate, as described in <xref
                                linkend="sec-docs-semantic-inflection"/>. </para>
                        <para xml:id="confreq-mo-docprops-package">It <literal role="rfc2119">must</literal> be packaged with the
                                <xref linkend="gloss-epub-publication"/> as shown in <xref
                                linkend="sec-docs-package"/>. </para>
                    </listitem>
                </varlistentry>
                <varlistentry xml:id="confreq-mo-fileprops">
                    <term>File Properties</term>
                    <listitem>
                        <para xml:id="confreq-mo-fileprops-name">The Media Overlay Document filename
                            <literal role="rfc2119">should</literal> use the file extension <filename>.smil</filename>.</para>
                        <!-- not needed since we forbid external markup declarations
                        <para xml:id="confreq-mo-fileprops-docfragname">Document fragments included
                            via external general entities <xref linkend="refXML"/> <literal role="rfc2119">should not</literal> use
                            the <filename>.smil</filename> extension. </para>
                            -->
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>

        <section xml:id="sec-overlays-rs-conf">
            <title>Reading System Conformance</title>

            <para><xref linkend="gloss-epub-reading-system"/> support for Media Overlays is
            	<literal role="rfc2119">optional</literal>. A Reading System that supports Media Overlays <literal role="rfc2119">must</literal> meet the following
                criteria:</para>

            <itemizedlist role="conformance-list">
                <listitem>
                    <para xml:id="confreq-rs-package-def">It <literal role="rfc2119">must</literal> process the Media Overlay Document
                        in conformance with all Reading System conformance constraints expressed in
                            <xref linkend="sec-overlays-def"/>.</para>
                    <!--<para xml:id="confreq-mo-behaviors">It <literal role="rfc2119">must</literal> adhere to the conformance requirements in <xref linkend="sec-overlay-behaviors"/>.</para>-->
                    <para xml:id="confreq-rs-xhtml-svg">It <literal role="rfc2119">must</literal> support <xref
                            linkend="gloss-content-document-epub-xhtml"/>s, and it <literal role="rfc2119">may</literal> support <xref
                            linkend="gloss-content-document-epub-svg"/>s.</para>
                    <para xml:id="confreq-rs-render">It <literal role="rfc2119">must</literal> render Media Overlay elements as
                        described in <xref linkend="sec-behaviors-playback"/>. </para>
                    <para xml:id="confreq-rs-navigation">It <literal role="rfc2119">must</literal> allow <xref linkend="gloss-user"/>
                        navigation while a Media Overlay is being played, as discussed in <xref
                            linkend="sec-rsconf-navigation"/>.</para>
                    <para xml:id="confreq-rs-embed">It <literal role="rfc2119">must</literal> adhere to rules regarding referenced
                        audio and video embedded in the <xref linkend="gloss-content-document-epub"
                        />, as stated in <xref linkend="sec-embedded-media"/>. </para>

                    <para xml:id="confreq-rs-tts"><xref linkend="gloss-tts"/>-capable Reading
                        Systems <literal role="rfc2119">should</literal> conform to <olink type="epub-spec" targetdoc="publications"
                            targetptr="confreq-rs-epub3-tts"/>.</para>

                    <para xml:id="confreq-rs-skip-escape">It <literal role="rfc2119">should</literal> offer the skippability and
                        escapability features described in <xref linkend="sec-behaviors-skip-escape"
                        />.</para>
                </listitem>
            </itemizedlist>

            <para>A Reading System that does not support Media Overlays <literal role="rfc2119">must</literal> meet the following
                criteria:</para>

            <itemizedlist role="conformance-list">
                <listitem>
                    <para xml:id="confreq-rs-mo-ignore">It <literal role="rfc2119">must</literal> ignore both the
                            <code>media-overlay</code> attribute on <xref linkend="gloss-manifest"/>
                        <code><olink targetdoc="publications" targetptr="elemdef-package-item"
                                type="epub-spec" epub:specref-exclude="true">item</olink></code>
                        elements and the manifest <code>item</code> elements where the
                            <code>media-type</code> attribute value equals
                            <literal>application/smil+xml</literal>.</para>
                </listitem>
            </itemizedlist>

        </section>

        <section xml:id="sec-overlays-def">
            <title>Media Overlay Document Definition</title>

            <para>All elements <xref linkend="refXML"/> defined in this section are in the
                    <literal>http://www.w3.org/ns/SMIL</literal> namespace <xref
                    linkend="refXMLNamespaces"/> unless otherwise specified.</para>

            <section xml:id="sec-smil-smil-elem">
                <title>The <literal>smil</literal> Element</title>

                <para>The <literal>smil</literal> element <literal role="rfc2119">must</literal> be the root element of all Media
                    Overlay Documents. </para>

                <variablelist xreflabel="smil" role="elem-synopsis" xml:id="elemdef-smil">
                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>smil</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                            <para>The <literal>smil</literal> element is the root element of the
                                Media Overlay Document.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Attributes</term>
                        <listitem>
                            <variablelist role="elem-synopsis-attlist">
                                <varlistentry>
                                    <term>
                                        <literal>version</literal>
                                        <option>[required]</option>
                                    </term>
                                    <listitem>
                                        <para>Specifies the version number of the <xref
                                                linkend="refSMIL"/> specification to which the Media
                                            Overlay adheres. </para>
                                        <para>This attribute <literal role="rfc2119">must</literal> have the value
                                                <literal>3.0</literal> to indicate compliance with
                                            this version of the specification.</para>
                                    </listitem>
                                </varlistentry>
                                <varlistentry>
                                    <term>
                                        <literal>id</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <xi:include href="./share/id-prose-para.xml"/>
                                    </listitem>
                                </varlistentry>
                                <varlistentry xml:id="attrdef-smil-prefix">
                                    <term>
                                        <literal>epub:prefix</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <para>Declares additional metadata vocabulary
                                            prefixes.</para>
                                        <para>Refer to <xref linkend="sec-docs-semantic-inflection"
                                            /> for more information.</para>
                                    </listitem>
                                </varlistentry>
                            </variablelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para>In this order: <literal>
                                    <xref linkend="elemdef-smil-head"/></literal>
                                <option>[optional]</option>, <literal><xref
                                        linkend="elemdef-smil-body"/></literal>
                                <option>[required]</option></para>
                        </listitem>
                    </varlistentry>
                </variablelist>

            </section>

            <section xml:id="sec-smil-head-elem">
                <title>The <literal>head</literal> Element</title>
                <para>The <literal>head</literal> element is the container for metadata in the Media
                    Overlay Document, and consists of zero or one child <literal>metadata</literal>
                    element.</para>

                <variablelist xreflabel="head" role="elem-synopsis" xml:id="elemdef-smil-head">
                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>head</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                            <para>The <literal>head</literal> element is the optional first child of
                                the <xref linkend="elemdef-smil"/> element.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Attributes</term>
                        <listitem>
                            <para>None.</para>
                        </listitem>
                    </varlistentry>

                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para><literal><xref linkend="elemdef-smil-metadata"/></literal>
                                <option>[0 or 1]</option>.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>

                <para>As this specification defines no metadata properties that must occur in the
                    Media Overlay Document, the <literal>head</literal> element is optional.</para>
            </section>

            <section xml:id="sec-smil-metadata-elem">
                <title>The <literal>metadata</literal> Element</title>
                <para>The <literal>metadata</literal> element represents metadata for the Media
                    Overlay Document. The <literal>metadata</literal> element is an extension point
                    that allows the inclusion of metadata from any metainformation structuring
                    language.</para>

                <variablelist xreflabel="metadata" role="elem-synopsis"
                    xml:id="elemdef-smil-metadata">
                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>metadata</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                            <para>As a child of the <xref linkend="elemdef-smil-head"/>
                                element.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>

                        <term>Attributes</term>
                        <listitem>
                            <para>None.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para><option>[0 or more]</option> elements from any namespace.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>

                <para>This specification defines no metadata properties that <literal role="rfc2119">must</literal> occur in the Media
                    Overlay Document; the <literal>metadata</literal> element is provided for custom
                    metadata requirements.</para>
            </section>

            <section xml:id="sec-smil-body-elem">
                <title>The <literal>body</literal> Element</title>
                <para>The <literal>body</literal> element is the starting point for the presentation
                    contained in the Media Overlay Document. It contains the main sequence of
                        <literal>par</literal> and <literal>seq</literal> elements. </para>
                <variablelist xreflabel="body" role="elem-synopsis" xml:id="elemdef-smil-body">
                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>body</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                        	<para>The <literal>body</literal> element is the required second child
                                of the <xref linkend="elemdef-smil"/> element.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Attributes</term>
                        <listitem>
                            <variablelist role="elem-synopsis-attlist">
                                <varlistentry xml:id="addrdef-smil-body-type">
                                    <term>
                                        <literal>epub:type</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <xi:include href="./share/epub-type-prose-listitem.xml"/>
                                </varlistentry>
                                <varlistentry>
                                    <term>
                                        <literal>id</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <xi:include href="./share/id-prose-para.xml"/>
                                    </listitem>
                                </varlistentry>
                                <varlistentry xml:id="attrdef-body-textref">
                                    <term>
                                        <literal>epub:textref</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <para>The relative IRI reference <xref linkend="refRFC3987"
                                            /> of the corresponding EPUB Content Document, including
                                            a fragment identifier that references the specific
                                            element as per the <xref linkend="refXPTRSH"/>.</para>
                                    </listitem>
                                </varlistentry>
                            </variablelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para>In any order: <literal><xref linkend="elemdef-smil-seq"
                                    /></literal>
                                <option>[0 or more]</option> or <literal><xref
                                        linkend="elemdef-smil-par"/></literal>
                                <option>[0 or more]</option></para>
                            <para>At least one <code>par</code> or <code>seq</code> is
                            	required.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </section>

            <section xml:id="sec-smil-seq-elem">
                <title>The <literal>seq</literal> Element</title>
                <para>The <literal>seq</literal> element contains media objects which are to be
                    rendered sequentially. </para>
                <variablelist xreflabel="seq" role="elem-synopsis" xml:id="elemdef-smil-seq">
                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>seq</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                            <para>One or more <literal>seq</literal> elements <literal role="rfc2119">may</literal> occur as children
                                of the <xref linkend="elemdef-smil-body"/> element and of the <xref
                                    linkend="elemdef-smil-seq"/> element.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Attributes</term>
                        <listitem>
                            <variablelist role="elem-synopsis-attlist">
                                <varlistentry>
                                    <term>
                                        <literal>epub:type</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <xi:include href="./share/epub-type-prose-listitem.xml"/>
                                </varlistentry>
                                <varlistentry>
                                    <term>
                                        <literal>id</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <xi:include href="./share/id-prose-para.xml"/>
                                    </listitem>
                                </varlistentry>
                                <varlistentry xml:id="attrdef-seq-textref">
                                    <term>
                                        <literal>epub:textref</literal>
                                        <option>[required]</option>
                                    </term>
                                    <listitem>
                                        <para>The relative IRI reference <xref linkend="refRFC3987"
                                            /> of the corresponding EPUB Content Document, including
                                            a fragment identifier that references the specific
                                            element as per the <xref linkend="refXPTRSH"/>.</para>
                                    </listitem>
                                </varlistentry>

                            </variablelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para>In any order: <literal><xref linkend="elemdef-smil-seq"
                                    /></literal>
                                <option>[0 or more]</option> or <literal><xref
                                        linkend="elemdef-smil-par"/></literal>
                                <option>[0 or more]</option>.</para>
                            <para>At least one <code>par</code> or <code>seq</code> is
                            	required.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </section>

            <section xml:id="sec-smil-par-elem">
                <title>The <literal>par</literal> Element</title>
                <para>The <literal>par</literal> element contains media objects which are to be
                    rendered in parallel. </para>
                <variablelist xreflabel="par" role="elem-synopsis" xml:id="elemdef-smil-par">
                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>par</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                            <para>One or more <literal>par</literal> elements <literal role="rfc2119">may</literal> occur as children
                                of the <xref linkend="elemdef-smil-body"/> and <xref
                                    linkend="elemdef-smil-seq"/> elements.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Attributes</term>
                        <listitem>
                            <variablelist role="elem-synopsis-attlist">
                                <varlistentry>
                                    <term>
                                        <literal>epub:type</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <xi:include href="./share/epub-type-prose-listitem.xml"/>
                                </varlistentry>
                                <varlistentry>
                                    <term>
                                        <literal>id</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <xi:include href="./share/id-prose-para.xml"/>
                                    </listitem>
                                </varlistentry>
                            </variablelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para>In any order: <literal><xref linkend="elemdef-smil-text"
                                    /></literal>
                                <option>[required]</option> and <literal><xref
                                        linkend="elemdef-smil-audio"/></literal>
                                <option>[optional]</option></para>
                            <para>The <xref linkend="elemdef-smil-audio"/> element is optional only
                                if its sibling <xref linkend="elemdef-smil-text"/> element refers to
                                audio or video media (see <xref linkend="sec-audio-video"/>), or to
                                textual content intended for rendering via <xref linkend="gloss-tts"
                                />.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </section>

            <section xml:id="sec-smil-text-elem">
                <title>The <literal>text</literal> Element</title>
                <para>The <literal>text</literal> element references an element in the <xref
                        linkend="gloss-content-document-epub"/>. A <literal>text</literal> element
                    typically refers to a textual element, but can also refer to other EPUB Content
                    Document media elements (see <xref linkend="sec-audio-video"/>).</para>
                <variablelist xreflabel="text" role="elem-synopsis" xml:id="elemdef-smil-text">
                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>text</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                        	<para>As a required child of the <xref linkend="elemdef-smil-par"/>
                                element.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Attributes</term>
                        <listitem>
                            <variablelist role="elem-synopsis-attlist">
                                <varlistentry>
                                    <term>
                                        <literal>src</literal>
                                        <option>[required]</option>
                                    </term>
                                    <listitem>
                                        <para>The relative IRI reference <xref linkend="refRFC3987"
                                            /> of the corresponding EPUB Content Document, including
                                            a fragment identifier that references the specific
                                            element as per the <xref linkend="refXPTRSH"/>.</para>
                                    </listitem>
                                </varlistentry>
                                <varlistentry>
                                    <term>
                                        <literal>id</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <xi:include href="./share/id-prose-para.xml"/>
                                    </listitem>
                                </varlistentry>
                            </variablelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para>Empty.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </section>

            <section xml:id="sec-smil-audio-elem">
                <title>The <literal>audio</literal> Element</title>
                <para>The <literal>audio</literal> element represents a clip of audio media.</para>
                <variablelist xreflabel="audio" role="elem-synopsis" xml:id="elemdef-smil-audio">

                    <varlistentry>
                        <term>Element Name</term>
                        <listitem>
                            <para>
                                <literal>audio</literal>
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Usage</term>
                        <listitem>
                        	<para>A required child of the <xref linkend="elemdef-smil-par"/> element
                                unless its sibling <xref linkend="elemdef-smil-text"/> element
                        		refers to audio or video media, in which case it is optional (see
                                    <xref linkend="sec-audio-video"/>).</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Attributes</term>
                        <listitem>
                            <variablelist role="elem-synopsis-attlist">
                                <varlistentry>
                                    <term>
                                        <literal>id</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <xi:include href="./share/id-prose-para.xml"/>
                                    </listitem>
                                </varlistentry>
                                <varlistentry>
                                    <term>
                                        <literal>src</literal>
                                        <option>[required]</option>
                                    </term>
                                    <listitem>
                                        <para>The relative or absolute IRI reference <xref
                                                linkend="refRFC3987"/> of an audio file. The audio
                                            file <literal role="rfc2119">must</literal> be one of the audio formats listed in the
                                                <olink type="epub-spec" targetdoc="publications"
                                                targetptr="sec-core-media-types">Core Media
                                                Types</olink> table.</para>
                                    </listitem>
                                </varlistentry>
                                <varlistentry xml:id="attrdef-smil-clipBegin" xreflabel="clipBegin">
                                    <term>
                                        <literal>clipBegin</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <para>A clock value that specifies the offset into the
                                            physical media corresponding to the start point of an
                                            audio clip.</para>
                                        <xi:include href="./share/clip-time-para.xml"/>
                                    </listitem>
                                </varlistentry>
                                <varlistentry xml:id="attrdef-smil-clipEnd" xreflabel="clipEnd">
                                    <term>
                                        <literal>clipEnd</literal>
                                        <option>[optional]</option>
                                    </term>
                                    <listitem>
                                        <para>A clock value that specifies the offset into the
                                            physical media corresponding to the end point of an
                                            audio clip.</para>
                                        <xi:include href="./share/clip-time-para.xml"/>
                                        <para>The chronological offset of the terminating position
                                            <literal role="rfc2119">must</literal> be after the starting offset specified in the
                                                <literal>clipBegin</literal> attribute.</para>
                                    </listitem>
                                </varlistentry>

                            </variablelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Content Model</term>
                        <listitem>
                            <para>Empty.</para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </section>
        </section>
    </chapter>

    <chapter xml:id="sec-overlay-docs">
        <title>Creating Media Overlays</title>

        <section xml:id="sec-docs-overview" conformance="informative">
            <title>Overview</title>
            <para>A pre-recorded narration of a publication can be represented as a series of audio
                clips, each corresponding to part of the <xref linkend="gloss-content-document-epub"
                />. A single audio clip, for example, typically represents a single phrase or
                paragraph, but infers no order relative to the other clips or to the text of a
                document. Media Overlays solve this problem of synchronization by tying the
                structured audio narration to its corresponding text (or other media) in the EPUB
                Content Document using <link linkend="refSMIL">SMIL</link> markup. Media Overlays
                are, in fact, a simplified subset of SMIL 3.0 that allow the playback sequence of
                these clips to be defined.</para>
            <para>The SMIL elements primarily used for structuring Media Overlays are <code><link
                        linkend="elemdef-smil-body">body</link></code> (used for the main sequence),
                        <code><link linkend="elemdef-smil-seq">seq</link></code> (sequence) and
                        <code><link linkend="elemdef-smil-par">par</link></code> (parallel). (Refer
                to <xref linkend="sec-overlays-def"/> for more information on these and other SMIL
                elements.)</para>
            <para>The <literal>par</literal> element is the basic building block of an Overlay and
                corresponds to a phrase in the EPUB Content Document. The element provides two key
                pieces of information for synchronizing content: 1) the audio clip containing the
                narration for the phrase; and 2) a pointer to the associated EPUB Content Document
                fragment. The <literal>par</literal> element uses two media element children to
                represent this information: an <code><link linkend="elemdef-smil-audio"
                    >audio</link></code> element and a <code><link linkend="elemdef-smil-text"
                        >text</link></code> element. Since <literal>par</literal> elements render
                their children in parallel, the audio clip and EPUB Content Document fragment are
                played at the same time, resulting in a synchronized presentation. </para>
            <para>The <literal>text</literal> element <literal>src</literal> attribute references
                the associated phrase, sentence, or other segment of the EPUB Content Document by
                its IRI reference. The <literal>audio</literal> element <literal>src</literal>
                attribute similarly references the location of the corresponding audio clip, and
                adds the optional <code><link linkend="attrdef-smil-clipBegin"
                    >clipBegin</link></code> and <code><link linkend="attrdef-smil-clipEnd"
                        >clipEnd</link></code> attributes to indicate a specific offset within the
                clip.</para>

            <informalexample>
                <para>The following example shows the Media Overlays markup for a single phrase or
                    sentence.</para>
                <synopsis><xi:include parse="text" href="./examples/overlays/overlay-partial-1.xml"/></synopsis>
            </informalexample>

            <para><literal>par</literal> elements are placed together sequentially to form a series
                of phrases or sentences. Not every element of the EPUB Content Document will have a
                corresponding <literal>par</literal> element in the Media Overlay, only those
                relevant to the audio narration.</para>

            <informalexample>
                <para>The following example shows a basic Media Overlay Document containing a
                    sequence of phrases. The <literal>body</literal> element acts as the main
                    sequence for the whole document.</para>
                <synopsis><xi:include parse="text" href="./examples/overlays/overlay-1.xml"/></synopsis>
            </informalexample>

            <para><literal>par</literal> elements can also be added to <literal>seq</literal>
                elements to define more complex structures such as parts and chapters (see <xref
                    linkend="sec-media-overlays-structure"/>). </para>

        </section>

        <section xml:id="sec-docs-relations">
            <title>Relationship to the EPUB Content Document</title>

            <note>
                <para>In this section, the <xref linkend="gloss-content-document-epub"/> is assumed
                    to be an <xref linkend="gloss-content-document-epub-xhtml"/>. While Media
                    Overlays can be used with <xref linkend="gloss-content-document-epub-svg"/>s,
                    playback behavior might not be consistent and therefore interoperability is not
                    guaranteed.</para>
            </note>

            <section xml:id="sec-media-overlays-structure">
                <title>Structure </title>
                <para>The ordering of the Media Overlay elements <literal role="rfc2119">must</literal> match the default reading
                    order of the EPUB Content Document. The <code><link linkend="elemdef-smil-par"
                            >par</link></code> element represents phrases, and the <code><link
                            linkend="elemdef-smil-seq">seq</link></code> element (sequence)
                    represents nested EPUB Content Document containers such as sections, asides,
                    headers, and footnotes. <literal>seq</literal> children <literal role="rfc2119">must</literal> be other
                        <literal>seq</literal> or <literal>par</literal> elements. Each
                        <literal>seq</literal> element <literal role="rfc2119">must</literal> contain an <code><link
                            linkend="attrdef-body-textref">epub:textref</link></code> attribute
                    which references the corresponding EPUB Content Document element by IRI
                    reference. </para>

                <informalexample xml:id="example-mo-nesting">
                    <para>The following example shows a Media Overlay Document with nested
                            <literal>seq</literal> elements, representing a chapter with both a
                        section header and a sidebar, which itself has a nested figure. </para>

                    <synopsis><xi:include parse="text" href="./examples/overlays/overlay-2.xml"/></synopsis>
                </informalexample>
            	
            	<note>
            		<para>The reason for grouping structures like sidebars,
            			section headers, figures, tables, and footnotes in a <literal>seq</literal>
            			element is so that their start and end positions can be identified during
            			playback. Reading Systems can then offer playback options tailored to the layout
            			of the Publication, such as jumping past a long sidebar, turning off rendering
            			of page break announcements (see <xref linkend="sec-behaviors-skip-escape"/>),
            			or customizing the reading mode to suit structures such as tables.</para>
            	</note>
            	
                <informalexample>
                    <para>The following example shows the EPUB Content Document that corresponds to
                        the <link linkend="example-mo-nesting">previous Media Overlay
                        example</link>.</para>
                    <synopsis><xi:include parse="text" href="./examples/overlays/media-content-doc-1.xml"/></synopsis>
                </informalexample>

            </section>
            <section xml:id="sec-media-overlays-granularity" conformance="informative">
                <title>Granularity</title>
                <para>Media Overlay <code><link linkend="elemdef-smil-text">text</link></code>
                    elements' <literal>src</literal> attributes refer to <xref
                        linkend="gloss-content-document-epub"/> elements by their IDs <xref
                        linkend="refXML"/>. The granularity level of the Media Overlay therefore
                    depends on how the EPUB Content Document is marked up. If the finest level of
                    markup is at the paragraph level, then that is the finest possible level at
                    which Media Overlay synchronization can be authored. Likewise, if sub-paragraph
                    markup is available, such as <xref linkend="refHTML5"/>
                    <code><link
                            xlink:href="http://www.w3.org/TR/html5/Overview.html#the-span-element"
                            >span</link></code> elements representing phrases or sentences, then
                    finer granularity is possible in the Media Overlay. Finer granularity gives
                        <xref linkend="gloss-user"/>s more precise results for synchronized playback
                    when navigating by word or phrase and when searching the text, but increases the
                    file size of the Media Overlay Documents.</para>
            </section>
            <section xml:id="sec-audio-video">
                <title>Embedded Audio and Video</title>
                <para>Any <xref linkend="gloss-content-document-epub"/> associated with a Media
                    Overlay <literal role="rfc2119">may</literal> contain embedded media such as video, audio, and images. The Media
                	Overlay <code><link linkend="elemdef-smil-text">text</link></code> element <literal role="rfc2119">may</literal>
                    be used in such instances to reference the embedded media by its ID <xref
                        linkend="refXML"/> value. </para>
                <para>When a <literal>text</literal> element references embedded media that contains
                    audio, no <code><link linkend="elemdef-smil-audio">audio</link></code> sibling
                	element is required, though one is allowed. </para>
                <para><xref linkend="gloss-author"/>s <literal role="rfc2119">should</literal> avoid using scripts to control playback
                    of referenced embedded EPUB Content Document media, as this may conflict with
                    Media Overlays playback behavior.</para>
            </section>
            <section xml:id="sec-tts">
                <title>Text-to-Speech</title>
                <para> This specification allows the use of <xref linkend="gloss-tts"/> in addition
                    to pre-recorded audio clips. When a Media Overlay <code><link
                            linkend="elemdef-smil-text">text</link></code> element with no
                            <code><link linkend="elemdef-smil-audio">audio</link></code> sibling
                    element references an element within the target <xref
                        linkend="gloss-content-document-epub"/>, the contents of that referenced
                    element <literal role="rfc2119">must</literal> be appropriate for rendering via TTS. For example, it could be a
                    textual EPUB Content Document element or contain a text fallback. </para>
            </section>
        </section>

        <section xml:id="sec-docs-semantic-inflection">
            <title>Semantic Inflection</title>

            <para>In order to express semantic inflections, the <olink targetdoc="contentdocs"
            	targetptr="attrdef-epub-type" type="epub-spec">epub:type attribute</olink> <literal role="rfc2119">may</literal>
                be attached to Media Overlay <code><link linkend="elemdef-smil-par"
                    >par</link></code>, <code><link linkend="elemdef-smil-seq">seq</link></code>,
                and <code><link linkend="elemdef-smil-body">body</link></code> elements.</para>

            <para>Values for the Media Overlay <code>epub:type</code> attribute are constrained
                identically to the <code>epub:type</code> attribute in <xref
                    linkend="gloss-content-document-epub"/>. Refer to <olink type="epub-spec"
                    targetdoc="contentdocs" targetptr="sec-xhtml-semantic-inflection"/> for details. </para>

            <para> The <code>epub:type</code> attribute facilitates Reading System behavior
                appropriate for the semantic type(s) indicated. Examples of these behaviors are
                    <xref linkend="sec-behaviors-skip-escape"/> and <xref
                    linkend="note-table-reading-mode"/>.</para>
            <informalexample>
                <para>The following example shows the semantic markup for a Media Overlay containing
                    a sidebar.</para>
                <synopsis><xi:include parse="text" href="./examples/overlays/overlay-3.xml"/></synopsis>
            </informalexample>

            <para>This specification adopts the vocabulary association mechanisms defined in <olink
                    targetdoc="contentdocs" targetptr="sec-contentdocs-vocab-association"
                    type="epub-spec"/> unmodified. Terms from the <olink targetdoc="contentdocs"
                    targetptr="sec-contentdocs-default-vocab" type="epub-spec">default
                    vocabulary</olink> <literal role="rfc2119">must</literal> be used unprefixed in Overlay Documents.</para>

        </section>

        <section xml:id="sec-docs-assoc-style">
            <title>Associating Style Information</title>
            <para>Visual rendering information for the currently-playing <xref
                    linkend="gloss-content-document-epub"/> element <literal role="rfc2119">may</literal> be expressed in the <xref
                    linkend="gloss-stylesheet"/> using an author-defined class. This author-defined
                class name <literal role="rfc2119">should</literal> be declared in the <xref linkend="gloss-package-document"/>
                metadata, using the metadata property <literal><xref linkend="active-class"
                    /></literal>. The class name is then discoverable by Reading Systems. </para>


            <para>This example demonstrates how authors may associate style information with the
                currently-playing EPUB Content Document element. </para>

            <note>
                <para>Although this example uses the class name
                        <literal>-epub-media-overlay-active</literal>, any class name is
                    permitted.</para>
            </note>

            <informalexample>

                <para>The author-defined CSS class name, declared using the metadata property <xref
                        linkend="active-class"/> in the Package Document:</para>
                <synopsis><![CDATA[<meta property="media:active-class">-epub-media-overlay-active</meta>]]></synopsis>

                <para>The EPUB Style Sheet containing the author-defined class name:</para>
                <synopsis><xi:include parse="text" href="./examples/overlays/media-overlay.css"/></synopsis>

                <para>The relevant EPUB Content Document excerpt:</para>
                <synopsis><![CDATA[<span id="txt1">This is the first phrase.</literal>
<span id="txt2">This is the second phrase.</literal>
<span id="txt3">This is the third phrase.</literal>]]></synopsis>

            </informalexample>

            <para>In this example, the Reading System would apply the author-defined
                    <literal>-epub-media-overlay-active</literal> class to each text element in the
                EPUB Content Document as it became active during playback. Conversely, the class
                name is removed when the element is no longer active. The User would see each EPUB
                Content Document element styled with a yellow background for the duration of that
                element's playback. </para>



        </section>

        <section xml:id="sec-docs-package">
            <title>Packaging</title>
            <section xml:id="sec-package-including">
                <title>Including Media Overlays</title>
                <para><link linkend="gloss-manifest">Manifest</link>
                    <olink targetdoc="publications" targetptr="elemdef-package-item"
                        type="epub-spec">item elements</olink> in the <xref
                        linkend="gloss-package-document"/> <literal role="rfc2119">may</literal> specify a Media Overlay via the
                            <code><olink targetdoc="publications"
                            targetptr="attrdef-item-media-overlay" epub:specref-exclude="true"
                            type="epub-spec">media-overlay</olink></code> attribute. Media Overlays
                    are themselves manifest items and <literal role="rfc2119">must</literal> be referred to by their IDs <xref
                        linkend="refXML"/>.</para>
                <informalexample>
                    <para>The following example shows how to include Media Overlays in the manifest
                        of a Package Document.</para>
                    <synopsis><xi:include parse="text" href="./examples/overlays/media-package-partial-1.xml"/></synopsis>
                </informalexample>
                <para>Manifest items which refer to Media Overlays <literal role="rfc2119">must</literal> have the media-type
                        <literal>application/smil+xml</literal> as specified in <olink
                        targetdoc="publications" targetptr="sec-core-media-types" type="epub-spec"
                    />.</para>
                <para>The <literal>media-overlay</literal> attribute <literal role="rfc2119">must</literal> be attached to manifest
                        <code>item</code> elements that reference <xref
                        linkend="gloss-content-document-epub"/>s only.</para>
                <para>A single Media Overlay file <literal role="rfc2119">may</literal> refer to more than one EPUB Content Document,
                    but an EPUB Content Document <literal role="rfc2119">must not</literal> be referenced by more than one Media
                    Overlay file. </para>
            	<para>Each EPUB Content Document manifest <code>item</code> is <literal role="rfc2119">not required</literal> to have
                    a Media Overlay associated with it. If an EPUB Content Document is wholly or
                    partially referenced by a Media Overlay, then its manifest <code>item</code>
                    entry <literal role="rfc2119">must</literal> indicate this via the <literal>media-overlay</literal>
                    attribute.</para>
                <para>This is a forwards-compatible addition: 2.0 Reading Systems <literal role="rfc2119">may</literal> safely ignore
                    the <literal>media-overlay</literal> attribute and process documents in their
                    normal fashion.</para>
            </section>
            <section xml:id="sec-package-metadata">
                <title>Media Overlays Metadata Vocabulary</title>

                <para> The following tables both define a set of properties for use in <xref
                        linkend="gloss-package-document"/> metadata and constitute a referenceable
                    vocabulary. </para>

                <para>The base IRI for referencing this vocabulary is
                        <uri>http://www.idpf.org/epub/vocab/overlays/#</uri>.</para>

                <note>
                    <para>The prefix <olink targetdoc="publications"
                            targetptr="sec-metadata-reserved-vocabs" type="epub-spec"
                            epub:specref-exclude="true">media:</olink> is reserved by <xref
                            linkend="refPublications3"/> for the inclusion of these properties in
                        package metadata.</para>
                </note>

                <informaltable xml:id="rdfa-vocab-overlays">
                    <info role="rdfa-vocab-info">
                        <annotation>
                            <para>Media Overlay properties</para>
                        </annotation>
                    </info>
                    <tgroup cols="2" xml:id="active-class" xreflabel="active-class">
                        <colspec colname="c1"/>
                        <colspec colname="c2"/>
                        <spanspec spanname="s1" namest="c1" nameend="c2"/>
                        <tbody>
                            <row>
                                <entry spanname="s1" role="rdfa-property">
                                    <literal>active-class</literal>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Description:</entry>
                                <entry role="rdfa-property-desc">Author-defined CSS class name to
                                    apply to the currently-playing EPUB Content Document
                                    element.</entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Allowed value(s):</entry>
                                <entry>
                                    <literal>xsd:string</literal>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Cardinality:</entry>
                                <entry>
                                    <literal>zero or one</literal>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Example:</entry>
                                <entry>
                                    <code><![CDATA[<meta property="media:active-class">-epub-media-overlay-active</meta>]]></code>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                    <tgroup cols="2" xml:id="duration" xreflabel="duration">
                        <colspec colname="c1"/>
                        <colspec colname="c2"/>
                        <spanspec spanname="s1" namest="c1" nameend="c2"/>
                        <tbody>
                            <row>
                                <entry spanname="s1" role="rdfa-property">
                                    <literal>duration</literal>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Description:</entry>
                                <entry role="rdfa-property-desc">The duration of the entire
                                    presentation or of a specific Media Overlay. The specified
                                    durations account for the audio clips known at authoring time,
                                    and so exclude live streaming from external resources and speech
                                    synthesis.</entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Allowed value(s):</entry>
                                <entry><para>A clock value.</para><xi:include
                                        href="./share/clip-time-para.xml"/>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Cardinality:</entry>
                                <entry>Exactly one for the Publication and for each Media
                                    Overlay.</entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Example:</entry>
                                <entry>
                                    <code><![CDATA[<meta property="media:duration">1:36:20</meta>]]></code>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                    <tgroup cols="2" xml:id="narrator">
                        <colspec colname="c1"/>
                        <colspec colname="c2"/>
                        <spanspec spanname="s1" namest="c1" nameend="c2"/>
                        <tbody>
                            <row>
                                <entry spanname="s1" role="rdfa-property">
                                    <literal>narrator</literal>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Description:</entry>
                                <entry role="rdfa-property-desc">Name of the narrator.</entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Allowed value(s):</entry>
                                <entry>
                                    <literal>xsd:string</literal>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Cardinality:</entry>
                                <entry>
                                    <literal>zero or more</literal>
                                </entry>
                            </row>
                            <row>
                                <entry role="rdfa-property-header">Example:</entry>
                                <entry>
                                    <code><![CDATA[<meta property="media:narrator">Joe Speaker</meta>]]></code>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </informaltable>

                <para>The Package Document <literal role="rfc2119">must</literal> include the <literal>duration</literal> of each
                	Media Overlay as well as of the entire Publication. The Package Document <literal role="rfc2119">may</literal>
                    include <literal>narrator</literal> information, as well, in particular when
                    each Media Overlay has its own narrator or there is one narrator specified for
                    the entire Publication. The Package Document <literal role="rfc2119">may</literal> also include an author-defined
                    CSS class name to be applied to the currently-playing EPUB Content Document
                    element.</para>

                <para>When a <literal>meta</literal> element is specific to a single Media Overlay
                    Document, the <literal>refines</literal> attribute is used to reference which one.
                    A <literal>meta</literal> element without a <literal>refines</literal> attribute
                    is considered to be about the entire Publication. The
                        <literal>active-class</literal> property <literal role="rfc2119">must not</literal> be used in conjunction
                    with a <literal>refines</literal> attribute, as it is always considered to apply
                    to the entire Publication.</para>
                <informalexample>
                    <para>The following example shows a Package Document with metadata about Media
                        Overlays.</para>
                    <synopsis><xi:include parse="text" href="./examples/overlays/media-package-partial-2.xml"/></synopsis>
                </informalexample>
            </section>
            <!--</chapter>-->
        </section>
    </chapter>

    <chapter xml:id="sec-overlay-behaviors">
        <title>Playback Behaviors</title>

        <section xml:id="sec-behaviors-loading">
            <title>Loading the Media Overlay</title>
            <para>When an <xref linkend="gloss-epub-reading-system"/> loads a <xref
                    linkend="gloss-package-document"/>, it <literal role="rfc2119">must</literal> refer to the <xref
                    linkend="gloss-manifest"/>
                <code><olink targetdoc="publications" targetptr="elemdef-package-item"
                        type="epub-spec" epub:specref-exclude="true">item</olink></code> elements'
                    <literal>media-overlay</literal> attributes to discover the corresponding Media
                Overlays for <xref linkend="gloss-content-document-epub"/>s. Playback <literal role="rfc2119">must</literal> start at
                the Media Overlay element which corresponds to the desired EPUB Content Document
                starting point. Note that the start of an EPUB Content Document <literal role="rfc2119">may</literal> correspond to an
                element at the start or in the middle of a Media Overlay. When the Media Overlay
                Document has finished playing, the Reading System <literal role="rfc2119">should</literal> load the next EPUB Content
                Document (as specified in the Package Document <xref linkend="gloss-spine"/>) and
                also load its corresponding Media Overlay Document, provided that one is given.
            </para>
        </section>

        <section xml:id="sec-behaviors-playback">
            <title>Basic Playback</title>
            <!-- <para>User Agents <literal role="rfc2119">must</literal> support the EPUB Media Overlay subset of <xref
                linkend="refSMIL"/> as defined in <xref linkend="sec-overlays-elem-attr"
                />.</para> -->
            <section xml:id="sec-rsconf-timing-synch">
                <title>Timing and Synchronization</title>
                <para>Reading Systems <literal role="rfc2119">must</literal> render immediate children of the <code><link
                            linkend="elemdef-smil-body">body</link></code> element in a sequence. A
                            <code><link linkend="elemdef-smil-seq">seq</link></code> element's
                    children <literal role="rfc2119">must</literal> be rendered in sequence, and playback completes when the last
                    child has finished playing. A <literal linkend="elemdef-smil-par">par</literal>
                    element's children <literal role="rfc2119">must</literal> be rendered in parallel (with each starting at the same
                    time), and playback completes when all the children have finished playing. When
                    the <literal>body</literal> element's last child has finished playing, playback
                    of the Media Overlay Document is done.</para>
            </section>
            <section xml:id="sec-rsconf-rendering-audio">
                <title>Rendering Audio</title>
                <para>When presented with a Media Overlay <code><link linkend="elemdef-smil-audio"
                            >audio</link></code> element, Reading Systems <literal role="rfc2119">must</literal> play the audio
                    resource referenced by the <literal>src</literal> attribute, starting at the
                    clip offset time given by the <code><link linkend="attrdef-smil-clipBegin"
                            >clipBegin</link></code> attribute and ending at the clip offset time
                    given by the <code><link linkend="attrdef-smil-clipEnd">clipEnd</link></code>
                    attribute. The following rules <literal role="rfc2119">must</literal> be observed:</para>
                <itemizedlist>
                    <listitem>
                        <para>If <literal>clipBegin</literal> is not specified, its value is assumed
                            to be <literal>0</literal>.</para>
                    </listitem>
                    <listitem>
                        <para>If <literal>clipEnd</literal> is not specified, its value is assumed
                            to be the full duration of the physical media. </para>
                    </listitem>
                    <listitem>
                        <para>If <literal>clipEnd</literal> exceeds the full duration of the
                            physical media, then its value is assumed to be the full duration of the
                            physical media.</para>
                    </listitem>
                </itemizedlist>

            	<para>User-controllable audio playback options should
                    include timescale modification, in which the playback rate is altered without
                    distorting the pitch. The suggested range is half-speed to double-speed.</para>
            </section>
            <section xml:id="sec-rsconf-rendering-text">
                <title>Rendering EPUB Content Document Elements</title>
                <para>When presented with a Media Overlay <code><link linkend="elemdef-smil-text"
                            >text</link></code> element, Reading Systems <literal role="rfc2119">should</literal> ensure the EPUB
                    Content Document element referenced by the <code>src</code> attribute is visible
                    in the <xref linkend="gloss-viewport"/>. Reading Systems with a <xref
                        linkend="gloss-viewport-css"/> <literal role="rfc2119">should</literal> add the class name given by the
                    metadata property <literal><xref linkend="active-class"/></literal> to the
                    actively-playing EPUB Content Document element. Conversely, the class name
                    <literal role="rfc2119">should</literal> be removed when the element is no longer active.</para>
                <para>The <literal>active-class</literal> metadata property is optional, and if
                    omitted, Reading System behavior is implementation-specific.</para>



            </section>
        </section>

        <section xml:id="sec-behaviors-interaction">
            <title>Interacting with the EPUB Content Document</title>
            <section xml:id="sec-rsconf-navigation">
                <title>Navigation</title>
                <para>Because the Media Overlay is closely linked to the <xref
                        linkend="gloss-content-document-epub"/>, it is very easy for Reading Systems
                    to locate a position in the EPUB Content Document based on the current position
                    in the Media Overlay playback. If the <xref linkend="gloss-user"/> pauses
                    synchronized playback and navigates to a different part of the <link
                        linkend="gloss-epub-publication">Publication</link>, synchronized playback
                    <literal role="rfc2119">must</literal> resume at that point. For example, if a specific page number in the EPUB
                    Content Document is the desired location, then this same point is located in the
                    Media Overlay and playback started there. </para>
                <para>This same approach allows for synchronizing the Media Overlay playback with
                    User selection of a navigation points in the <xref
                        linkend="gloss-content-document-epub-nav"/>. The Reading System loads the
                    Media Overlay for that file and finds the correct point for starting playback
                    based on the ID <xref linkend="refXML"/> of the navigation point target.</para>
                <note>
                    <title>Associating a Media Overlay Document with the Navigation Document</title>
                    <para>A Media Overlay Document may also be associated directly with a Navigation
                        Document in order to provide synchronized playback of its contents,
                        regardless of whether the <xref linkend="gloss-content-document-epub-xhtml"
                        /> in which it resides is included in the <xref linkend="gloss-spine"/>. The
                        Reading System should keep playback of the Navigation Document's Media
                        Overlay synchronized with the User's current position in the EPUB Content
                        Document. </para>
                </note>

                <note xml:id="note-table-reading-mode">
                    <title>Table Reading Mode</title>
                    <para>Media Overlay Document elements may be associated with EPUB Content
                        Document structures such as tables. Reading Systems should ensure that Media
                        Overlay playback remains synchronized with User navigation of table rows and
                        cells. The Reading System may also play the corresponding table header
                        preceding the contents of the cell.</para>
                </note>
            </section>
            <section xml:id="sec-embedded-media">
                <title>Embedded Audio and Video</title>
                <para> An <xref linkend="gloss-content-document-epub"/> with which a Media Overlay
                    is associated <literal role="rfc2119">may</literal> itself contain embedded video and audio media, which <literal role="rfc2119">may</literal> be
                    pointed to by Media Overlay elements. Unlike text and images, video and audio
                    media has an intrinsic duration. Consequently, when a Reading System renders the
                    synchronization described by a Media Overlay, the default playback behavior of
                    audio and video media embedded within the associated EPUB Content Document <literal role="rfc2119">must</literal>
                    be overridden.</para>
                <para>Note that the rules below apply only to <emphasis role="italic"
                        >referenced</emphasis>
                    <xref linkend="refHTML5"/>
                    <code><link xlink:href="http://www.w3.org/TR/html5/Overview.html#video"
                            >video</link></code> or <code><link
                            xlink:href="http://www.w3.org/TR/html5/Overview.html#audio"
                        >audio</link></code> elements within the associated EPUB Content Document.
                    That is to say, the rules apply to only those elements pointed to by <code><link
                            linkend="elemdef-smil-text">text</link></code> elements within the Media
                    Overlay (i.e., via the <literal>src</literal> attribute). Embedded media that is
                    not referenced by Media Overlay elements is not subject to these rules.</para>
                <itemizedlist>
                    <listitem>
                        <para>All referenced audio and video media embedded within an EPUB Content
                            Document <literal role="rfc2119">must</literal> have their public playback interface deactivated
                            (typically: play/pause control, time slider, volume level, etc.). This
                            behavior is required to avoid interference between the scheduled
                            playback sequence defined by the Media Overlay, and the arbitrary
                            playback behavior due to <xref linkend="gloss-user"/> interaction or
                            script execution. As a result, when the Reading System is in playback
                            mode, it <literal role="rfc2119">should</literal>: <itemizedlist>
                                <listitem>
                                    <para>Hide the individual video/audio UI controls from the page,
                                        which overrides the default behavior defined by the <xref
                                            linkend="refHTML5"/>
                                        <code><link
                                                xlink:href="http://www.w3.org/TR/html5/Overview.html#attr-media-controls"
                                                >controls</link></code> attribute. </para>
                                </listitem>
                                <listitem>
                                    <para>Prevent scripts embedded within the EPUB Content Document
                                        from invoking the JavaScript audio/video playback API (i.e.,
                                        authored as part of the default Publication behavior). It is
                                        <literal role="rfc2119">recommended</literal> that content producers avoid publishing
                                        embedded scripts dedicated to controlling the playback of
                                        embedded audio/video media. The published Media Overlay can
                                        then retain full control of the synchronized presentation
                                        without any risk of interference from script-enabled custom
                                        behaviors. </para>
                                </listitem>
                            </itemizedlist></para>
                    </listitem>
                    <listitem>
                        <para>All referenced audio and video media embedded within an EPUB Content
                            Document <literal role="rfc2119">must</literal> be initialized to their "stopped" state, and be ready to
                            be played from the zero-position within their content stream (possibly
                            displaying the image specified using the <xref linkend="refHTML5"/>
                            <code><link
                                    xlink:href="http://www.w3.org/TR/html5/Overview.html#attr-video-poster"
                                    >poster</link></code> attribute). This requirement overrides the
                            default behavior defined by the <xref linkend="refHTML5"/>
                            <code><link
                                    xlink:href="http://www.w3.org/TR/html5/Overview.html#attr-media-autoplay"
                                    >autoplay</link></code> attribute. </para>
                    </listitem>
                    <listitem>
                        <para>When an EPUB Content Document element becomes active, the <xref
                                linkend="gloss-stylesheet"/> visual highlighting rules apply
                            regardless of the content type referred to by that element's
                                <code>src</code> attribute (e.g., the CSS class name defined by the
                                <xref linkend="active-class"/> metadata property <literal role="rfc2119">should</literal> be applied
                            to visible video and audio player controls within the host EPUB Content
                            Document). </para>
                    </listitem>
                    <listitem>
                        <para>In addition to the default behavior of Media Overlay activation for
                            textual fragments and images, audio and video playback <literal role="rfc2119">must</literal> be started
                            and stopped according to the duration implied by the authored Media
                            Overlay synchronization (as per the standard <xref linkend="refSMIL"/>
                            timing model). There are two possible scenarios: <itemizedlist>
                                <listitem>
                                    <para>When a Media Overlay <literal>text</literal> element has
                                        no <code><link linkend="elemdef-smil-audio"
                                            >audio</link></code> sibling within its <literal><link
                                                linkend="elemdef-smil-par">par</link></literal>
                                        parent container, the referenced EPUB Content Document audio
                                        or video media <literal role="rfc2119">must</literal> play until it ends, at which point the
                                            <literal>text</literal> element's lifespan terminates.
                                        In this case, the implicit duration of the
                                            <literal>text</literal> element (and by inference, of
                                        the parent <literal>par</literal> container) is that of the
                                        referenced audio or video clip.</para>
                                </listitem>
                                <listitem>
                                    <para>When a Media Overlay <literal>text</literal> element has
                                        an <literal>audio</literal> sibling within its
                                            <literal>par</literal> parent container, the playback
                                        duration of the referenced EPUB Content Document audio or
                                        video media <literal role="rfc2119">must</literal> be constrained by the duration of the
                                            <literal>audio</literal> sibling. In this case, the
                                        actual duration of the parent <literal>par</literal>
                                        container is that of the child audio clip, regardless of the
                                        duration of the video or audio media pointed to by the
                                    	<literal>text</literal> element. This behavior may
                                        result in embedded video or audio media ending playback
                                        prematurely (before reaching its full duration), or ending
                                        before the playback of the parallel Media Overlay
                                            <literal>audio</literal> is finished (in which case the
                                        last-played video frame <literal role="rfc2119">should</literal> remain visible until the
                                        parent <literal>par</literal> container finally ends). This
                                        behavior is equivalent of the Media Overlay
                                            <literal>audio</literal> element implicitly carrying the
                                        behavior of the <xref linkend="refSMIL"/>
                                        <link
                                            xlink:href="http://www.w3.org/TR/SMIL/smil-timing.html#adef-endsync"
                                                ><literal>endsync</literal></link> attribute.</para>
                                    <para>Furthermore, Reading Systems <literal role="rfc2119">should</literal> expose User controls
                                        for the volume levels of each independent audio track (i.e.,
                                        from the <literal>audio</literal> element of the Media
                                        Overlay, and from the embedded audio or video media within
                                        the EPUB Content Document), so that audio output can be
                                        adjusted to match listeners' requirements. Note that having
                                        overlapping audio tracks is typically an authoring-time
                                        concern: content producers usually add a layer of audio
                                        information over a video track for description purposes. It
                                        is <literal role="rfc2119">recommended</literal> that overlapping audio situations are
                                        carefully examined and dealt with at production stage, as
                                        Reading Systems are <literal role="rfc2119">not required</literal> to handle simultaneous
                                        volume levels in any particular way.</para>
                                </listitem>
                            </itemizedlist></para>
                    </listitem>
                    <listitem>
                        <para>When a <literal>text</literal> element becomes inactive in the Media
                            Overlay, and when it points to embedded video or audio media, that
                            referenced media <literal role="rfc2119">must</literal> be reset to its initial "stopped" state, ready to
                            be played from the zero-position within their content stream (possibly
                            displaying the poster image specified using the HTML5 markup). </para>
                    </listitem>
                </itemizedlist>
            </section>
            <section xml:id="sec-text-to-speech">
                <title>Text-to-Speech</title>
                <para>When a Media Overlay <code><link linkend="elemdef-smil-text"
                        >text</link></code> element with no <code><link linkend="elemdef-smil-audio"
                            >audio</link></code> sibling element references text within the target
                        <xref linkend="gloss-content-document-epub"/>, Reading Systems capable of
                        <xref linkend="gloss-tts"/> <literal role="rfc2119">should</literal> render the referenced text using
                    TTS.</para>

                <para>As per Reading System conformance requirements, the speech-related information
                    provided in the target EPUB Content Document <literal role="rfc2119">should</literal> be used to play the audio
                    stream as part of the Media Overlay rendering. See <olink type="epub-spec"
                        targetdoc="publications" targetptr="confreq-rs-epub3-tts"/>.</para>

                <para>The Media Overlay <literal>text</literal> element's lifespan corresponds to
                    the rendering time of the associated speech synthesis. The implicit duration of
                    the <literal>text</literal> element (and by inference, of the parent
                        <literal>par</literal> element) is therefore determined by the execution of
                    the Text-to-Speech engine, and cannot be known at authoring time (factors like
                    speech rate, pauses and other prosody parameters influence the audio
                    output).</para>
            </section>
        </section>

        <section xml:id="sec-behaviors-skip-escape">
            <title>Skippability and Escapability</title>
            <section xml:id="sec-skippability">
                <title>Skippability</title>
                <para>While reading, <xref linkend="gloss-user"/>s may want to turn on or off
                    certain features of the <link linkend="gloss-epub-publication"
                        >Publication</link>, such as sidebars, footnotes, page numbers, or other
                    types of secondary content. This feature is called skippability. Reading Systems
                    <literal role="rfc2119">should</literal> use the semantic information provided by Media Overlay elements'
                            <code><link linkend="sec-docs-semantic-inflection"
                        >epub:type</link></code> attribute to determine when to offer Users the
                	option of skippable features. In the following example, a Reading System <literal role="rfc2119">should</literal>
                    offer the User the option of turning on and off the page break/page number
                    announcements, which are often cumbersome to listen to.</para>
                <informalexample>
                    <para>The following example shows a Media Overlay Document with a
                        pagebreak.</para>
                    <synopsis><xi:include parse="text" href="./examples/overlays/overlay-4.xml"/></synopsis>
                </informalexample>
                <informalexample>
                    <para>The following example shows an EPUB Content Document with a
                        pagebreak.</para>
                    <synopsis><xi:include parse="text" href="./examples/overlays/media-content-doc-partial-1.xml"/></synopsis>
                </informalexample>
                <para>The following selection of terms from the <xref
                        linkend="refEPUBStructureVocab"/> for which Reading Systems <literal role="rfc2119">should</literal> offer
                    Users the option of skippability is provided as an informative reference: <itemizedlist>
                        <listitem>
                            <para>sidebar</para>
                        </listitem>
                        <listitem>
                            <para>practice</para>
                        </listitem>
                        <listitem>
                            <para>marginalia</para>
                        </listitem>
                        <listitem>
                            <para>annotation</para>
                        </listitem>
                        <listitem>
                            <para>help</para>
                        </listitem>
                        <listitem>
                            <para>note</para>
                        </listitem>
                        <listitem>
                            <para>footnote</para>
                        </listitem>
                        <listitem>
                            <para>rearnote</para>
                        </listitem>
                        <listitem>
                            <para>pagebreak</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para>Media Overlays <literal role="rfc2119">may</literal> use additional vocabularies by defining them in the
                            <code><link linkend="attrdef-smil-prefix">epub:prefix</link></code>
                    attribute on the root <code>smil</code> element. Reading System support for
                    skippability based on <code>epub:type</code> values <literal role="rfc2119">should not</literal> be
                    assumed.</para>
            </section>
            <section xml:id="sec-escabaility">
                <title>Escapability</title>
                <para>Escapable items are nested structures such as tables, lists, and sidebars that
                    listeners may wish to skip over, continuing to read from the point immediately
                    after the nested structure. The escapability feature differs from the
                    skippability feature in that it does not enable or disable entire types of
                    items, but provides an exit from them (e.g., a User can listen to some of the
                    content before choosing to escape). Reading Systems <literal role="rfc2119">should</literal> allow escaping of
                    nested structures. Reading Systems <literal role="rfc2119">must</literal> determine the start of nested structures
                    by the value of the <code><link linkend="sec-docs-semantic-inflection"
                            >epub:type</link></code> attribute (e.g., <literal>glossary</literal>)
                    and <literal role="rfc2119">should</literal> offer Users the option to skip playback of that structure and resume
                    with whatever content comes after it. </para>
                <informalexample>
                    <para>The following example shows the Media Overlay Document for an EPUB Content
                        Document containing a paragraph, a glossary, and another paragraph. A
                        Reading System that supported escapability would give the User the option to
                        interrupt playback of the glossary and continue playing the document
                        paragraphs.</para>
                    <synopsis><xi:include parse="text" href="./examples/overlays/overlay-5.xml"/></synopsis>
                </informalexample>
            </section>
        </section>
    </chapter>

    <appendix xml:id="app-overlays-schema">
        <title>Media Overlays Schema</title>
        <para>The schema for Media Overlays is available at <link
                xlink:href="../schema/media-overlay-30.nvdl"
            >../schema/media-overlay-30.nvdl</link>.</para>
        <para>This schema is normative.</para>

        <section conformance="informative" xml:id="app-overlays-schema-using">
            <title>Using the Media Overlays Schema</title>
            <para>Validation of Media Overlays using this schema will require a processor that
                supports <xref linkend="refNVDL"/>, <xref linkend="refRelaxNG"/> and <xref
                    linkend="refISOSchematron"/>.</para>
            <para>Note, however, that the NVDL schema layer can be substituted by a two-pass
                validation using the embedded RELAX NG and ISO Schematron schemas alone.</para>
        </section>

    </appendix>

    <appendix xml:id="app-clock-examples" conformance="informative">
        <title>Examples of Clock Values</title>
        <para>The following are examples of allowed clock values:</para>
        <informalexample>
            <itemizedlist>
                <listitem>
                    <para><literal>5:34:31.396</literal> = 5 hours, 34 minutes, 31 seconds and 396
                        milliseconds</para>
                </listitem>
                <listitem>
                    <para><literal>124:59:36</literal> = 124 hours, 59 minutes and 36 seconds</para>
                </listitem>
                <listitem>
                    <para><literal>0:05:01.2</literal> = 5 minutes, 1 second and 200
                        milliseconds</para>
                </listitem>
                <listitem>
                    <para><literal>0:00:04</literal> = 4 seconds</para>
                </listitem>

                <listitem>
                    <para><literal>09:58</literal> = 9 minutes and 58 seconds</para>
                </listitem>
                <listitem>
                    <para><literal>00:56.78</literal> = 56 seconds and 780 milliseconds</para>
                </listitem>

                <listitem>
                    <para><literal>76.2s</literal> = 76.2 seconds = 76 seconds and 200
                        milliseconds</para>
                </listitem>
                <listitem>
                    <para><literal>7.75h</literal> = 7.75 hours = 7 hours and 45 minutes</para>
                </listitem>
                <listitem>
                    <para><literal>13min</literal> = 13 minutes</para>
                </listitem>
                <listitem>
                    <para><literal>2345ms</literal> = 2345 milliseconds</para>
                </listitem>
                <listitem>
                    <para><literal>12.345</literal> = 12 seconds and 345 milliseconds</para>
                </listitem>
            </itemizedlist>


        </informalexample>
    </appendix>

    <xi:include href="./share/contributors.xml"/>

    <xi:include href="./share/references.xml"/>

    <appendix xml:id="DUMMY_REMOVE">
        <!-- a dummy that is removed by the build -->
        <title>THIS SECTION SHOULD NOT BE IN THE BUILD</title>
        <para xml:id="sec-css"/>
        <para xml:id="sec-contentdocs"/>
        <para xml:id="sec-manifest-elem"/>
        <para xml:id="physical-container-zip"/>
        <para xml:id="sec-package-documents"/>
        <para xml:id="sec-xhtml"/>
        <para xml:id="sec-svg"/>
        <para xml:id="sec-core-media-types"/>
        <para xml:id="sec-spine-elem"/>
        <para xml:id="sec-fallback-processing-flow"/>
        <para xml:id="sec-scripted-content"/>
        <para xml:id="sec-xhtml-nav"/>
        <para xml:id="sec-xml-constraints"/>
        <para xml:id="sec-opf-metadata-identifiers-pid"/>
        <para xml:id="sec-resource-locations"/>
        <para xml:id="confreq-spine-itemtypes"/>
        <para xml:id="sec-link-elem"/>
        <para xml:id="sec-publication-resources"/>
    </appendix>
</book>
