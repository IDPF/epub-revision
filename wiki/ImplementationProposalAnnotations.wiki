#summary Implementation proposal for annotations.

= Introduction =

This is a wiki page to collaboratively edit an implementation proposal for the "annotations" part of the revision of the EPUB standard. This document is in inception phase.

Please refer to the [Annotations annotations requirements page] (http://code.google.com/p/epub-revision/wiki/Annotations)

<wiki:toc max_depth="5" />

= Editors / Contributors =

  * Will Manis
  * Daniel Weck
 * (add your name here)

= Reusing the EPub format for annotations =

Annotations would be an additional part of an OCF container.

== Abstract Container: ==
{{{
META-INF/
   container.xml – Note: includes multiple <rootfile> elements
   [manifest.xml]
   [metadata.xml]
   [signatures.xml]
   [encryption.xml]
   [rights.xml]
***[annotations.xml]***
OEBPS/
   Great Expectations.opf
   cover.html
   chapters/
      chapter01.html
      chapter02.html
      … other OPS files for the remaining chapters …
}}}

An annotation itself would refer to annotated content and the annotators content, which could be co-located or contained in other documents. It is probably reasonable to limit the annotators content to be local to the container holding the annotations.

The example below illustrates a textual annotation on textual content. 
Need examples for:
  # ink annotation of text
  # ink annotation of image or svg
  # annotation of audio/video

== annotations.xml ==
{{{
<annotations xmlns="http://www.idpf.org/2011/annotation">

   <annotation id="uuid">
      <referenceddocument>
	 <documentidentifier>
	    <!-- ANNOT_R3 -->
	    ISBN, DOI etc.
	 </documentidentifier>
	 <date>
	    2010:09:08:17:17:34 UT
	 </date>
	 
	 <contentsignature>
	    <!-- ANNOT_R1 -->
	    a dsig over the referenced content or a superset of the content
	 </contentsignature>

	 [
	    <!-- much of the following is strongly dependent on UA not
	         altering the content, especially for portable
	         annotations ANNOT_TW_R2
	      -->
	    <!-- ANNOT_R4, ANNOT_R4.9 -->
	    <ranges>
	       <range>
		  <start>
		     <part>part in ocf container</part>
		     <location>a valid xpath 1.0 expression</location>
		     <!-- ANNOT_R4.1, ANNOT_R4.2, ANNOT_R4.3,
		          ANNOT_R4.4, we will need additional info in
			  location to cover ANNOT_R4.6, R4.7, R4.8, 
		       --> 
		  </start>
		  <end>
		     <part>part in ocf container</part>
		     <location>a valid xpath 1.0 expression</location>
		  </end>	 
	       </range>
	       <range>
		  .
		  .
		  .
	       </range>
	    </ranges>
	 
	    or
	    
	    <point>
	       <part>part in ocf container</part>
	       <location>a valid xpath 1.0 expression</location>
	    </point>
	 
	 ]
	 
	 <renderinginfo>
	    <!--  ANNOT_TW_R1 -->
	    <hilight>yellow</hilight>
	 </renderinginfo>	 
      </referenceddocument>
   
      <annotationcontent>
	 <!-- ANNOT_R1.1 -->
	 <author>
	    <name>Mark Twain</name>
	    <dsig></dsig>
	 </author>
	 <date>
	    2010:09:08:17:17:34 UT
	 </date>

	 <range>
	    <!-- ANNOT_R8 -->
	    <!-- this points to content in what is nominally an
	          epub file
	      -->
	    <start>
	       <part>part in ocf container</part>
	       <location>a valid xpath 1.0 expression</location>
	    </start>
	    <end>
	       <part>part in ocf container</part>
	       <location>a valid xpath 1.0 expression</location>
	    </end>	 
	 </range>
	 
	 <renderinginfo>
	    <balloon/>
	 </renderinginfo>
	 
      </annotationcontent>
   </annotation>
   
   <annotation id="uuid">
      .
      .
      .
   </annotation>
      
</annotations>
}}}

== User agent rendering ==
It will be up to the UA to determine the UI to capture and render annotations.

= An entirely new format for storage and rendering of annotations =

This is in here strictly for completeness, looking for an implementation proposal...